<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>isNineSun&#39;s Blog</title>
  
  
  <link href="http://yoursite.com/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2023-11-01T17:50:44.331Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>NineSun</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>惯性人体姿态解算——动捕设备的实现 Part1</title>
    <link href="http://yoursite.com/2023/04/15/HPS-Part1/"/>
    <id>http://yoursite.com/2023/04/15/HPS-Part1/</id>
    <published>2023-04-15T09:58:04.000Z</published>
    <updated>2023-11-01T17:50:44.331Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-设计思路-amp-硬件选择"><a href="#1-设计思路-amp-硬件选择" class="headerlink" title="1.设计思路&amp;硬件选择"></a>1.设计思路&amp;硬件选择</h2><p>我希望动捕设备最好能无线连接PC，所以esp32就成了首选，不用再多加一个透传模块，而且价格也便宜，另外就是IMU的选型，这个的选择项就非常多了，一些精度高的IMU价格非常夸张，所以这里就使用最常见的六轴IMU MPU6050，物美价廉，漂移和噪声问题确定很大，但是可以放在软件算法里去尽量做优化，不过调过姿态控制的都知道，六轴传感器的偏航角几乎是不可用的，这是六轴传感器工作机制导致的，只能用角速度去积分获取偏航角，然后一定程度上通过横滚角和俯仰角去矫正，理想的状态下，静态响应还是凑合的，但是动态响应几乎就是灾难，在动捕这个领域，这显然是不合适的，因此为了获得更为准确的yaw角度，我选择添加一个磁力计，HMC5883L，虽然磁力计也同样会有被环境干扰问题，比如周围的磁场，但是它的yaw角很大程度上至少是可信的，环境干扰也可以放在软件算法里面去尽量矫正。<br>所以最后确定的下位机方案就是使用esp32+mpu6050+HMC5883L,成本大概30块钱左右，然后关于上位机的选择，因为这次涉及到3D模型，当然是请出老朋友unity，下位机采集解算出来的欧拉角直接通过wifi与PC走UDP（延时小）通信传输数据，然后再在PC端根据欧拉角还原人体姿态，大致思路就是这个样子。       </p><h2 id="2-硬件设计"><a href="#2-硬件设计" class="headerlink" title="2.硬件设计"></a>2.硬件设计</h2><p>硬件方面IMU直接用的是模块，因为裸片买不起（悲），然后尺寸尽可能小巧，没有画成两面板是因为就算把尺寸再画小一点，电池容量也可能不太够了，索性定在了45mm * 45mm的尺寸上了能一面画完，能放一个800mah的锂电池，项目工程都再立创开源了，以下是链接：<br><a href="https://oshwhub.com/isninesun/hpsv204">立创开源广场项目链接</a></p><h3 id="PCB-Layout"><a href="#PCB-Layout" class="headerlink" title="PCB Layout"></a>PCB Layout</h3><p><img src="https://raw.githubusercontent.com/isNineSun/img_repository/main/%24MJ%7BUE%2403%7DLU1%25THN1PR5%5DH.png">    </p><h3 id="3D渲染图"><a href="#3D渲染图" class="headerlink" title="3D渲染图"></a>3D渲染图</h3><p><img src="https://raw.githubusercontent.com/isNineSun/img_repository/main/3D.png">    </p><h2 id="3-软件设计"><a href="#3-软件设计" class="headerlink" title="3.软件设计"></a>3.软件设计</h2><h3 id="3-1-设备软件"><a href="#3-1-设备软件" class="headerlink" title="3.1 设备软件"></a>3.1 设备软件</h3><p>软件上项目源代码我会放在github仓库上，需要参考的可直接点击–&gt;    </p><p>下面主要贴一些比较关键的代码:   </p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Solution_algorithm.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;init.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*计算偏移量*/</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">float</span> i;                                    <span class="comment">//计算偏移量时的循环次数</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">float</span> ax_offset = <span class="number">0</span>, ay_offset = <span class="number">0</span>;         <span class="comment">//x,y轴的加速度偏移量</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">float</span> gx_offset = <span class="number">0</span>, gy_offset = <span class="number">0</span>;         <span class="comment">//x,y轴的角速度偏移量</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">float</span> yaw_offset = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">float</span> mag_offset_x = <span class="number">0.0</span>, mag_offset_y = <span class="number">0.0</span>, mag_offset_z = <span class="number">0.0</span>; <span class="comment">//x,y,z轴的地磁偏移量</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*参数*/</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">float</span> rad2deg = <span class="number">57.29578</span>;                   <span class="comment">//弧度到角度的换算系数</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">float</span> roll_v = <span class="number">0</span>, pitch_v = <span class="number">0</span>, yaw_v = <span class="number">0</span>;              <span class="comment">//换算到x,y,z轴上的角速度</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">float</span> gravity = <span class="number">9.8</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">float</span> alpha = <span class="number">0.5</span>;  <span class="comment">// 互补滤波系数</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">float</span> beta = <span class="number">0.1</span>;   <span class="comment">// 倾斜补偿系数</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*定义微分时间*/</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">float</span> now = <span class="number">0</span>, lasttime = <span class="number">0</span>, dt = <span class="number">0</span>;        <span class="comment">//定义微分时间</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*三个状态，先验状态，观测状态，最优估计状态*/</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">float</span> gyro_roll = <span class="number">0</span>, gyro_pitch = <span class="number">0</span>, gyro_yaw = <span class="number">0</span>;        <span class="comment">//陀螺仪积分计算出的角度，先验状态</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">float</span> acc_roll = <span class="number">0</span>, acc_pitch = <span class="number">0</span>, acc_yaw = <span class="number">0</span>;          <span class="comment">//加速度计观测出的角度，观测状态</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">float</span> k_roll = <span class="number">0</span>, k_pitch = <span class="number">0</span>, t_yaw = <span class="number">0</span>;              <span class="comment">//卡尔曼滤波后估计出最优角度，最优估计状态</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">float</span> tilt_yaw = <span class="number">0</span>;  <span class="comment">//倾斜补偿后的yaw角数据</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">float</span> yaw_buf[WINDOW_SIZE];</span><br><span class="line"></span><br><span class="line"><span class="comment">/*误差协方差矩阵P*/</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">float</span> e_P[<span class="number">2</span>][<span class="number">2</span>] =&#123;&#123;<span class="number">1</span>,<span class="number">0</span>&#125;,&#123;<span class="number">0</span>,<span class="number">1</span>&#125;&#125;;             <span class="comment">//误差协方差矩阵，这里的e_P既是先验估计的P，也是最后更新的P</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*卡尔曼增益K*/</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">float</span> k_k[<span class="number">2</span>][<span class="number">2</span>] =&#123;&#123;<span class="number">0</span>,<span class="number">0</span>&#125;,&#123;<span class="number">0</span>,<span class="number">0</span>&#125;&#125;;             <span class="comment">//这里的卡尔曼增益矩阵K是一个2X2的方阵</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">float</span> <span class="title">sliding_window_filter</span><span class="params">(<span class="keyword">float</span> *buf, <span class="keyword">float</span> new_data)</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    <span class="keyword">float</span> sum = <span class="number">0.0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(i = (WINDOW_SIZE - <span class="number">1</span>); i&gt;<span class="number">0</span>; i--)</span><br><span class="line">    &#123;</span><br><span class="line">        buf[i - <span class="number">1</span>] = buf[i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将新数据存入缓存区</span></span><br><span class="line">    buf[WINDOW_SIZE - <span class="number">1</span>] = new_data;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 计算缓存区中所有数据的和</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; WINDOW_SIZE; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        sum += buf[i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回平均值</span></span><br><span class="line">    <span class="keyword">return</span> sum / WINDOW_SIZE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Caculate_RollPitch_by_Kalman</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">/*计算微分时间*/</span></span><br><span class="line">    now = <span class="built_in">millis</span>();                           <span class="comment">//当前时间(ms)</span></span><br><span class="line">    dt = (now - lasttime) / <span class="number">1000.0</span>;           <span class="comment">//微分时间(s)</span></span><br><span class="line">    lasttime = now;                           <span class="comment">//上一次采样时间(ms)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/*获取角速度和加速度 */</span></span><br><span class="line">    <span class="keyword">sensors_event_t</span> a, g, temp;</span><br><span class="line">    mpu.<span class="built_in">getEvent</span>(&amp;a, &amp;g, &amp;temp);<span class="comment">//获取加速度、角速度、温度</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/*step1:计算先验状态*/</span></span><br><span class="line">    <span class="comment">/*计算x,y轴上的角速度*/</span></span><br><span class="line">    roll_v = (g.gyro.x-gx_offset) + ((<span class="built_in">sin</span>(k_pitch)*<span class="built_in">sin</span>(k_roll))/<span class="built_in">cos</span>(k_pitch))*(g.gyro.y-gy_offset) + ((<span class="built_in">sin</span>(k_pitch)*<span class="built_in">cos</span>(k_roll))/<span class="built_in">cos</span>(k_pitch))*g.gyro.z;<span class="comment">//roll轴的角速度</span></span><br><span class="line">    pitch_v = <span class="built_in">cos</span>(k_roll)*(g.gyro.y-gy_offset) - <span class="built_in">sin</span>(k_roll)*g.gyro.z;<span class="comment">//pitch轴的角速度</span></span><br><span class="line">    gyro_roll = k_roll + dt*roll_v;<span class="comment">//先验roll角度</span></span><br><span class="line">    gyro_pitch = k_pitch + dt*pitch_v;<span class="comment">//先验pitch角度</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/*step2:计算先验误差协方差矩阵P*/</span></span><br><span class="line">    e_P[<span class="number">0</span>][<span class="number">0</span>] = e_P[<span class="number">0</span>][<span class="number">0</span>] + <span class="number">0.0025</span>;<span class="comment">//这里的Q矩阵是一个对角阵且对角元均为0.0025</span></span><br><span class="line">    e_P[<span class="number">0</span>][<span class="number">1</span>] = e_P[<span class="number">0</span>][<span class="number">1</span>] + <span class="number">0</span>;</span><br><span class="line">    e_P[<span class="number">1</span>][<span class="number">0</span>] = e_P[<span class="number">1</span>][<span class="number">0</span>] + <span class="number">0</span>;</span><br><span class="line">    e_P[<span class="number">1</span>][<span class="number">1</span>] = e_P[<span class="number">1</span>][<span class="number">1</span>] + <span class="number">0.0025</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*step3:更新卡尔曼增益K*/</span></span><br><span class="line">    k_k[<span class="number">0</span>][<span class="number">0</span>] = e_P[<span class="number">0</span>][<span class="number">0</span>]/(e_P[<span class="number">0</span>][<span class="number">0</span>]+<span class="number">0.3</span>);</span><br><span class="line">    k_k[<span class="number">0</span>][<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    k_k[<span class="number">1</span>][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    k_k[<span class="number">1</span>][<span class="number">1</span>] = e_P[<span class="number">1</span>][<span class="number">1</span>]/(e_P[<span class="number">1</span>][<span class="number">1</span>]+<span class="number">0.3</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*step4:计算最优估计状态*/</span></span><br><span class="line">    <span class="comment">/*观测状态*/</span></span><br><span class="line">    <span class="comment">//roll角度</span></span><br><span class="line">    acc_roll = <span class="built_in">atan</span>((a.acceleration.y - ay_offset) / (a.acceleration.z)) * rad2deg;</span><br><span class="line">    <span class="comment">//pitch角度</span></span><br><span class="line">    acc_pitch = <span class="number">-1</span>*<span class="built_in">atan</span>((a.acceleration.x - ax_offset) / <span class="built_in">sqrt</span>(<span class="built_in">sq</span>(a.acceleration.y - ay_offset) + <span class="built_in">sq</span>(a.acceleration.z))) * rad2deg;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*最优估计状态*/</span></span><br><span class="line">    k_roll = gyro_roll + k_k[<span class="number">0</span>][<span class="number">0</span>]*(acc_roll - gyro_roll);</span><br><span class="line">    k_pitch = gyro_pitch + k_k[<span class="number">1</span>][<span class="number">1</span>]*(acc_pitch - gyro_pitch);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*step5:更新协方差矩阵P*/</span></span><br><span class="line">    e_P[<span class="number">0</span>][<span class="number">0</span>] = (<span class="number">1</span> - k_k[<span class="number">0</span>][<span class="number">0</span>])*e_P[<span class="number">0</span>][<span class="number">0</span>];</span><br><span class="line">    e_P[<span class="number">0</span>][<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    e_P[<span class="number">1</span>][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    e_P[<span class="number">1</span>][<span class="number">1</span>] = (<span class="number">1</span> - k_k[<span class="number">1</span>][<span class="number">1</span>])*e_P[<span class="number">1</span>][<span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">float</span> <span class="title">caculate_Yaw</span><span class="params">(<span class="keyword">float</span> roll,<span class="keyword">float</span> pitch,<span class="keyword">bool</span> init_flag)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">float</span> rollRad = <span class="number">0</span>, pitchRad = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">float</span> xh = <span class="number">0</span>,yh = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">sensors_event_t</span> event; </span><br><span class="line">    mag.<span class="built_in">getEvent</span>(&amp;event);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(init_flag)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">/*获取角速度和加速度 */</span></span><br><span class="line">        <span class="keyword">sensors_event_t</span> a, g, temp;</span><br><span class="line">        mpu.<span class="built_in">getEvent</span>(&amp;a, &amp;g, &amp;temp);</span><br><span class="line"></span><br><span class="line">        rollRad = <span class="built_in">asin</span>(-(a.acceleration.x/gravity));</span><br><span class="line">        pitchRad = <span class="built_in">atan</span>(a.acceleration.y/a.acceleration.z);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        rollRad = roll/rad2deg;</span><br><span class="line">        pitchRad = pitch/rad2deg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    xh = event.magnetic.x * <span class="built_in">cos</span>(pitchRad) + event.magnetic.y * <span class="built_in">sin</span>(pitchRad) * <span class="built_in">sin</span>(rollRad) + event.magnetic.z * <span class="built_in">sin</span>(pitchRad) * <span class="built_in">cos</span>(rollRad);</span><br><span class="line">    yh = event.magnetic.y * <span class="built_in">cos</span>(rollRad) - event.magnetic.z * <span class="built_in">sin</span>(rollRad);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Calculate tilt compensated heading</span></span><br><span class="line">    <span class="keyword">float</span> tiltCompensatedHeading = <span class="built_in">atan2</span>(yh, xh);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Correct for when signs are reversed.</span></span><br><span class="line">    <span class="keyword">if</span>(tiltCompensatedHeading &lt; <span class="number">0</span>)</span><br><span class="line">        tiltCompensatedHeading += <span class="number">2</span>*PI;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">// Check for wrap due to addition of declination.</span></span><br><span class="line">    <span class="keyword">if</span>(tiltCompensatedHeading &gt; <span class="number">2</span>*PI)</span><br><span class="line">        tiltCompensatedHeading -= <span class="number">2</span>*PI;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Convert radians to degrees for readability.</span></span><br><span class="line">    <span class="keyword">float</span> headingDegrees = tiltCompensatedHeading * <span class="number">180</span>/M_PI;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> headingDegrees;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">offset_init</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt;= <span class="number">2000</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">sensors_event_t</span> a, g, m, temp;</span><br><span class="line">        <span class="keyword">sensors_event_t</span> event; </span><br><span class="line">        mpu.<span class="built_in">getEvent</span>(&amp;a, &amp;g, &amp;temp);<span class="comment">//获取加速度、角速度、温度</span></span><br><span class="line">        mag.<span class="built_in">getEvent</span>(&amp;m);</span><br><span class="line">        ax_offset = ax_offset + a.acceleration.x;</span><br><span class="line">        ay_offset = ay_offset + a.acceleration.y;</span><br><span class="line">        gx_offset = gx_offset + g.gyro.x;</span><br><span class="line">        gy_offset = gy_offset + g.gyro.y;</span><br><span class="line"></span><br><span class="line">        mag_offset_x += m.magnetic.x;</span><br><span class="line">        mag_offset_y += m.magnetic.y;</span><br><span class="line">        mag_offset_z += m.magnetic.z;</span><br><span class="line">    &#125;</span><br><span class="line">    ax_offset = ax_offset / <span class="number">2000</span>;</span><br><span class="line">    ay_offset = ay_offset / <span class="number">2000</span>;</span><br><span class="line">    gx_offset = gx_offset / <span class="number">2000</span>;</span><br><span class="line">    gy_offset = gy_offset / <span class="number">2000</span>;</span><br><span class="line"></span><br><span class="line">    mag_offset_x /= <span class="number">2000</span>;</span><br><span class="line">    mag_offset_y /= <span class="number">2000</span>;</span><br><span class="line">    mag_offset_z /= <span class="number">2000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        yaw_offset += <span class="built_in">caculate_Yaw</span>(k_roll, k_pitch, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    yaw_offset /= <span class="number">100</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">get_Euler_angle</span><span class="params">(<span class="keyword">float</span>* roll, <span class="keyword">float</span>* pitch, <span class="keyword">float</span>* yaw)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">Caculate_RollPitch_by_Kalman</span>();</span><br><span class="line">    tilt_yaw = <span class="built_in">caculate_Yaw</span>(k_roll, k_pitch, <span class="literal">false</span>);</span><br><span class="line">    tilt_yaw = tilt_yaw &gt;= yaw_offset ? (tilt_yaw - yaw_offset) : ((<span class="number">360.0</span> - yaw_offset) + tilt_yaw);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(tilt_yaw &gt; <span class="number">180.0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        tilt_yaw -= <span class="number">360.0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    t_yaw = <span class="built_in">sliding_window_filter</span>(yaw_buf, tilt_yaw);</span><br><span class="line"></span><br><span class="line">    *roll = k_roll;</span><br><span class="line">    *pitch = k_pitch;</span><br><span class="line">    *yaw = t_yaw;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>由于IMU和磁力计采集到的数据都是有很大噪声的，而且消费级的IMU的漂移问题很严重，所以他们的数据直接拿来其实是不能用的，上面那段代码其实是一个卡尔曼滤波的处理，也算是姿态解算中很经典的处理算法了，具体的原理就不在这里展开了，关于卡尔曼滤波的教程和讲解网上有太多太多，我就不在这里班门弄斧了，卡尔曼滤波主要针对IMU，可以得到一个可用的Roll角和Pitch角，而Yaw角则需要用磁力计来解决，磁力计在外部坏境相对稳定的情况下，指北的表现还是比较好的，所以只对其数据进行简单的均值滤波其实在平面上就已可用，其问题在于倾斜情况下需要对磁偏角进行倾斜校正，不然会得到一个完全错误的数值，原因跟磁力计的工作方式有关，在此不多赘述，感兴趣可以看这篇文章了解其原理<a href="https://zhuanlan.zhihu.com/p/61765669%E3%80%82">基于加速度计与磁力计的姿态解算方法(加计补偿偏航)</a>。最后将获得的Roll、Pitch、Yaw角传出，后面的工作就是组报文 + UDP通信了，将数据传给PC上位机后，再由PC去根据欧拉角还原物体姿态。    </p><h3 id="3-2-上位机软件"><a href="#3-2-上位机软件" class="headerlink" title="3.2 上位机软件"></a>3.2 上位机软件</h3><p>如上面所说，上位机我用的是Unity，这里其实没有太多可说的，上位机全部的工作就是建立一个UDP的服务器，接收来自设备的包含欧拉角信息的消息并对其进行解析，然后使用角度信息对场景物体进行对应旋转，真要说的话，本文只是Part1，所以只做了一个Cube去做测试，具体人体姿态的解算和还原会放在Part2中去详细说明。上位机的Unity工程我同样会放在上文（3.1）提到的Github链接中。    </p><h2 id="4-效果演示"><a href="#4-效果演示" class="headerlink" title="4.效果演示"></a>4.效果演示</h2><p>这里放一张动图用来展示实际的效果：<br><img src="https://raw.githubusercontent.com/isNineSun/img_repository/main/test%2000_00_00-00_00_30.gif"></p><h2 id="5-总结"><a href="#5-总结" class="headerlink" title="5.总结"></a>5.总结</h2><p>这篇主要是实现一个集数验证，显示完成数据采集的工作，具体根据采集的数据解算出来的欧拉角去还原姿态的部分我打算放在上位机去做，这个就要等到Part2再说了。</p>]]></content>
    
    
    <summary type="html">最近比较沉迷虚拟主播，用来打发时间还是挺有意思的，一些3D势虚拟主播不可避免的就是会使用到动作捕捉设备，产生了一些兴趣，想简单实现一下。现在市面上大多数的动补方案是光学动补、惯性动补和混合动补三种方式，光学动补精度高，但是成本也高，而且捕捉质量与摄像头帧率和数量直接相关，惯性动补成本相对比较低，但是会不可避免的有各种漂移问题，成品商业方案大多是最后一种，是光学和惯性结合起来去做拟合，从而达成比较好的稳定性和精度。光学动补现在已经有很多商业公司开放付费使用的服务了，比如小K动补之类的，所以本文就不介绍光捕，而实现一个惯性动补。</summary>
    
    
    
    <category term="设计开发" scheme="http://yoursite.com/categories/%E8%AE%BE%E8%AE%A1%E5%BC%80%E5%8F%91/"/>
    
    <category term="嵌入式" scheme="http://yoursite.com/categories/%E8%AE%BE%E8%AE%A1%E5%BC%80%E5%8F%91/%E5%B5%8C%E5%85%A5%E5%BC%8F/"/>
    
    
    <category term="嵌入式开发" scheme="http://yoursite.com/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/"/>
    
    <category term="ESP32" scheme="http://yoursite.com/tags/ESP32/"/>
    
    <category term="惯性动补" scheme="http://yoursite.com/tags/%E6%83%AF%E6%80%A7%E5%8A%A8%E8%A1%A5/"/>
    
    <category term="姿态解算" scheme="http://yoursite.com/tags/%E5%A7%BF%E6%80%81%E8%A7%A3%E7%AE%97/"/>
    
  </entry>
  
  <entry>
    <title>基于Mqtt的城市智能路灯控制系统</title>
    <link href="http://yoursite.com/2022/02/17/MqttLightingServers/"/>
    <id>http://yoursite.com/2022/02/17/MqttLightingServers/</id>
    <published>2022-02-17T06:49:04.000Z</published>
    <updated>2023-11-01T17:50:37.333Z</updated>
    
    <content type="html"><![CDATA[<h2 id="摘要"><a href="#摘要" class="headerlink" title="摘要"></a>摘要</h2><p>这是一个城市智能路灯控制系统的设计，实现功能主要为光线充足时不亮灯，当光线不足时开始检测，如果有人或者有声音便亮起路灯，这是自动模式，设备可通过手机APP切换为手动模式，在手动模式下用户可通过手机APP来实现对路灯的操控。<br><strong>本项目本身逻辑比较简单，硬件部分也是很常见的设计</strong>，与之前做过的项目大同小异，本质上还是传感器采集信息然后单片机负责进行判断和开关电路。因此这个项目的重点其实在于<code>Mqtt</code>的使用，之前的几个物联网设计中，手机端的实现主要是依靠第三方的点灯科技的接口，这种方式实现联网终究<strong>可玩性还是太低了</strong>，况且对于一个硬件电子爱好者来说，实现物联网仅局限于云智能也太拉跨了，<strong>因此学习了<code>AndroidStudio</code>开发<code>App</code>从而实现Mqtt的通信协来控制设备实现物联网，我个人认为这一个流程的实现才是真正的物联网开发。</strong></p><hr><h2 id="一、原件清单"><a href="#一、原件清单" class="headerlink" title="一、原件清单"></a>一、原件清单</h2><ul><li>Esp8266NodeMCU*1  </li><li>人体热释红外传感器*1  </li><li>音量传感器*1  </li><li>光敏电阻传感器模块*1 </li><li>SSD1306显示屏*1 </li><li>杜邦线*1 </li><li>5V一路继电器  </li><li>18650锂电池*2  </li><li>三极管*1</li><li>杜邦线 若干<br><img src="http://tva1.sinaimg.cn/mw690/008ruEzYly1gzgkbnlhzaj30h30daqaj.jpg" alt="硬件连接.png"></li></ul><hr><h2 id="二、硬件连接"><a href="#二、硬件连接" class="headerlink" title="二、硬件连接"></a>二、硬件连接</h2><table><thead><tr><th>nodeMCU</th><th>ssd1306</th><th>光敏传感器</th><th>人体热释传感器</th><th>声音传感器</th><th>5V继电器</th><th>LED灯泡</th><th>NPN三极管</th><th>18650电源</th></tr></thead><tbody><tr><td>D6</td><td>SDA</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>D7</td><td>SCL</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>D0</td><td></td><td>DO</td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>D2</td><td></td><td></td><td></td><td>OUT</td><td></td><td></td><td></td><td></td></tr><tr><td>D8</td><td></td><td></td><td>OUT</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>D2</td><td></td><td></td><td></td><td></td><td></td><td></td><td>基极</td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td>IN</td><td></td><td>集电极</td><td></td></tr><tr><td>VCC</td><td>VCC</td><td>VCC</td><td>VCC</td><td>VCC</td><td>DC+</td><td></td><td>发射极</td><td></td></tr><tr><td>GND</td><td>GND</td><td>GND</td><td>GND</td><td>GND</td><td>DC-</td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td>COM1</td><td></td><td></td><td>+</td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td>-</td><td></td><td>-</td></tr><tr><td></td><td></td><td></td><td></td><td></td><td>NO</td><td>+</td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr></tbody></table><hr><h2 id="三、原理图-amp-流程图"><a href="#三、原理图-amp-流程图" class="headerlink" title="三、原理图&amp;流程图"></a>三、原理图&amp;流程图</h2><p><img src="http://tva1.sinaimg.cn/mw690/008ruEzYly1gzgkcslvbfj30mq0cemxr.jpg" alt="Mqtt城市智能路灯.png"><br>总体设计原理图  </p><p><img src="http://tva1.sinaimg.cn/mw690/008ruEzYly1gzgkpq5012j30g30cqmxu.jpg" alt="Mqtt城市智能路灯软件流程图.png"><br>软件流程图  </p><hr><h2 id="四、程序代码"><a href="#四、程序代码" class="headerlink" title="四、程序代码"></a>四、程序代码</h2><p>硬件程序：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;SSD1306Wire.h&quot;</span><br><span class="line">#include &lt;ESP8266WiFi.h&gt;</span><br><span class="line">#include &lt;PubSubClient.h&gt;</span><br><span class="line">WiFiClient espClient;</span><br><span class="line">PubSubClient client (espClient);</span><br><span class="line">const char* wifissid=&quot;test&quot;;</span><br><span class="line">const char* password=&quot;12345678&quot;;</span><br><span class="line">const char* mqtt_server=&quot;xxx.xxx.xxx.xxx&quot;;</span><br><span class="line">const char* mqtt_id=&quot;isNineSun_ESP&quot;;</span><br><span class="line">const char* Mqtt_sub_topic=&quot;pub_ywt&quot;;</span><br><span class="line">const char* Mqtt_pub_topic=&quot;sub_ywt&quot;;</span><br><span class="line">long lastMsg=0;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">int MIC = 4;        // D0 麦克风引脚连接开发板数字接口 2</span><br><span class="line">int LED = 0;        // LED  正极连接开发板数字接口3</span><br><span class="line">int HC = 15;</span><br><span class="line">int D_in=16;</span><br><span class="line">int VALOR;        // DO变量值</span><br><span class="line">int LEDDO;       // LED变量 </span><br><span class="line">int HoneWai;</span><br><span class="line">int Lighting; </span><br><span class="line">bool auto_mode=1,led_mode=1; </span><br><span class="line"></span><br><span class="line">static const uint8_t wu_you[][32]=&#123;0x00,0x80,0x40,0x40,0x42,0x20,0x42,0x10,0x42,0x0C,0xC2,0x03,0x7E,0x00,0x42,0x00,0xC2,0x3F,0x42,0x40,0x42,0x40,0x42,0x40,0x40,0x40,0x40,0x70,0x00,0x00,0x00,0x00,/*无0*/</span><br><span class="line">                 0x04,0x04,0x04,0x02,0x04,0x01,0x84,0x00,0xE4,0xFF,0x3C,0x09,0x27,0x09,0x24,0x09,0x24,0x09,0x24,0x49,0x24,0x89,0xE4,0x7F,0x04,0x00,0x04,0x00,0x04,0x00,0x00,0x00,/*有0*/&#125;;</span><br><span class="line">static const uint8_t ren[][32]=&#123;0x00,0x80,0x00,0x40,0x00,0x20,0x00,0x10,0x00,0x0C,0x00,0x03,0xC0,0x00,0x3F,0x00,0xC0,0x00,0x00,0x03,0x00,0x0C,0x00,0x10,0x00,0x20,0x00,0x40,0x00,0x80,0x00,0x00,/*人0*/&#125;;</span><br><span class="line">static const uint8_t sheng[][32]=&#123;0x04,0x80,0x14,0x60,0xD4,0x1F,0x54,0x02,0x54,0x02,0x54,0x02,0x54,0x02,0xDF,0x03,0x54,0x02,0x54,0x02,0x54,0x02,0x54,0x02,0xD4,0x03,0x14,0x00,0x04,0x00,0x00,0x00,/*声0*/&#125;;</span><br><span class="line">static const uint8_t guang[][32]=&#123;0x40,0x80,0x40,0x80,0x42,0x40,0x44,0x20,0x58,0x18,0xC0,0x07,0x40,0x00,0x7F,0x00,0x40,0x00,0xC0,0x3F,0x50,0x40,0x48,0x40,0x46,0x40,0x40,0x40,0x40,0x78,0x00,0x00,/*光0*/&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">const uint8_t image1[] PROGMEM =&#123;</span><br><span class="line">0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,</span><br><span class="line">0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x60,0xE0,0x00,0x00,0x00,0x00,0x00,0x00,0xF0,0xF0,0x01,0x00,0x00,0x00,0x00,0x00,0xF0,0xFC,0x01,0x00,0x00,0xF8,0xFF,0x3F,0xFF,0xFF,0x7F,0x00,0x00,0xF8,0xFF,0x7F,0xFF,0xF1,0x7F,0x00,0x00,0xF8,0xFF,0x7F,0xFF,0xE4,0x7F,0x00,0x00,0xF8,0xFF,0x7F,0x7F,0x9E,0x7F,0x00,</span><br><span class="line">0x00,0x78,0xCE,0x79,0x60,0x3E,0x00,0x00,0x00,0x7E,0xCE,0x79,0x0C,0xBC,0x39,0x00,0x00,0x7F,0xCE,0x79,0x9C,0x99,0x7B,0x00,0x00,0x7F,0xCE,0x79,0xDC,0xA3,0x7B,0x00,0x00,0x7F,0xCE,0x79,0xFF,0xBF,0x7F,0x00,0x00,0x7F,0xCE,0x79,0xFF,0xBF,0x3F,0x00,0x00,0x7E,0xCE,0x79,0xFF,0xF6,0x3F,0x00,0x00,0x78,0xCE,0x79,</span><br><span class="line">0xDF,0xF6,0x1F,0x00,0x00,0x78,0xCE,0x79,0xDE,0xF6,0x0F,0x00,0x00,0xF8,0xFF,0x7F,0xDE,0xF6,0x07,0x00,0x00,0xF8,0xFF,0x7F,0xFF,0xF6,0x3F,0x00,0x00,0xF8,0xFF,0x7F,0xFF,0xB6,0x3F,0x00,0x00,0xF8,0xFF,0x3F,0xFF,0xBF,0x7F,0x00,0x00,0xE0,0xFF,0x1F,0xDE,0xBF,0x7B,0x00,0x00,0x00,0x00,0x00,0xDC,0xBF,0x7B,0x00,</span><br><span class="line">0x00,0x00,0x00,0x00,0x1C,0x80,0x7B,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x03,0x3E,0x70,0x00,0x00,0x00,0x00,0x9E,0xC3,0x3F,0xF0,0x1C,0x38,0x00,0x00,0x9E,0xFB,0x3F,0xF0,0x1E,0x3C,0x00,0x00,0x9E,0xFF,0x3F,0xF0,0x1E,0x3C,0x00,0x00,0x9E,0xFF,0x3F,</span><br><span class="line">0xF0,0x3E,0x3E,0x00,0x00,0x9E,0xDF,0x3D,0xF0,0xFE,0x3F,0x00,0x00,0x9E,0x0F,0x3C,0xF0,0xFE,0x3F,0x00,0x00,0x9E,0x67,0x3C,0xF0,0xFE,0x3F,0x00,0x00,0x9E,0xF3,0x3F,0xF0,0xFE,0x3F,0x00,0x00,0x86,0xF3,0x3F,0xF0,0x3E,0x1E,0x00,0x00,0x32,0xC3,0x3F,0xF0,0x1E,0x1E,0x00,0x00,0x70,0x00,0x1F,0xFC,0x1C,0x1E,0x00,</span><br><span class="line">0x00,0x70,0x70,0x40,0xFF,0x01,0x1E,0x00,0x00,0xFE,0xFF,0x77,0xFF,0x77,0x0C,0x00,0x00,0xFF,0xFF,0x3F,0xFB,0xFF,0x01,0x00,0x00,0xFF,0xFF,0x03,0xE0,0xFF,0x0F,0x00,0x00,0xFF,0x1F,0x38,0xEE,0xFF,0x1F,0x00,0x00,0x78,0x00,0x78,0xCE,0xF0,0x3F,0x00,0x00,0x70,0x00,0x7C,0x9E,0x80,0x7C,0x00,0x00,0xF0,0xFF,0x7F,</span><br><span class="line">0x9E,0x00,0x7F,0x00,0x00,0xF0,0xFF,0x7F,0x9C,0x00,0x7F,0x00,0x00,0xF0,0xFF,0x3F,0xC0,0x00,0x3F,0x00,0x00,0x40,0x00,0x00,0x60,0x00,0x0E,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,</span><br><span class="line">0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/*C:\Users\NineSun\Desktop\未标题-1.bmp0*/</span><br><span class="line">&#125;;</span><br><span class="line">const uint8_t image2[] PROGMEM =&#123;</span><br><span class="line">0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,</span><br><span class="line">0x00,0x00,0x00,0x00,0x00,0x00,0x70,0x00,0x38,0x70,0x00,0x00,0x00,0xC0,0x79,0x00,0x78,0xF8,0x00,0x00,0x00,0xCE,0x7B,0x00,0x78,0xFE,0x00,0x00,0x00,0xCF,0x7B,0x80,0xFF,0xFF,0x3F,0x00,0x00,0xCF,0x7B,0x80,0xFF,0xF8,0x3F,0x00,0x00,0xCF,0x7B,0xBC,0x7F,0xF2,0x3F,0x00,0x00,0xCF,0x7B,0xBE,0x3F,0xEF,0x3F,0x00,</span><br><span class="line">0x00,0xCF,0x7B,0x3E,0x30,0x1F,0x00,0x00,0x00,0xCF,0x7B,0x3E,0x0E,0xDE,0x1D,0x00,0x00,0xFF,0xFF,0x3F,0xCE,0xCC,0x3D,0x00,0x00,0xFF,0xFF,0x3F,0xEF,0xD1,0x3D,0x00,0x00,0xFF,0xFF,0xBF,0xFF,0xDF,0x3F,0x00,0x00,0xFF,0xFF,0xBF,0xFF,0xDF,0x1F,0x00,0x00,0xFF,0xFF,0xBF,0x7F,0xFB,0x1F,0x00,0x00,0xCF,0x7B,0x80,</span><br><span class="line">0x7F,0xFB,0x0F,0x00,0x00,0xCF,0x7B,0x00,0x6F,0xFB,0x07,0x00,0x00,0xCF,0x7B,0x00,0x6F,0xFB,0x03,0x00,0x80,0xCF,0x7B,0x80,0x7F,0xFB,0x1F,0x00,0x80,0xCF,0x7B,0x80,0xFF,0xDF,0x1F,0x00,0x00,0xC7,0x7B,0x80,0xFF,0xDF,0x3F,0x00,0x00,0xC7,0x7B,0x00,0xEF,0xDF,0x3D,0x00,0x00,0xC0,0x79,0x00,0xEE,0xDF,0x3D,0x00,</span><br><span class="line">0x00,0x00,0x70,0x00,0x0E,0xC0,0x3D,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xC0,0x01,0x1F,0x78,0x00,0x00,0x00,0x00,0xCF,0xE1,0x1F,0x7C,0x0E,0x1E,0x00,0x00,0xCF,0xFF,0x1F,0x7C,0x1F,0x1E,0x00,0x00,0xCF,0xFF,0x1F,0x7C,0x1F,0x3E,0x00,0x00,0xCF,0xFF,0x1F,</span><br><span class="line">0x7C,0xFF,0x1F,0x00,0x00,0xCF,0xFF,0x1E,0x7C,0xFF,0x1F,0x00,0x00,0xCF,0x07,0x1E,0x7C,0xFF,0x1F,0x00,0x00,0xCF,0x3B,0x1E,0x7C,0xFF,0x1F,0x00,0x00,0xCF,0xF9,0x1F,0x7C,0xFF,0x1F,0x00,0x00,0xC3,0xF9,0x1F,0x7C,0x1F,0x1F,0x00,0x00,0xB9,0xE1,0x1F,0x7C,0x1F,0x0F,0x00,0x00,0xBC,0x80,0x0F,0x7F,0x0E,0x0F,0x00,</span><br><span class="line">0x00,0x3C,0x38,0xA0,0xFF,0x00,0x0F,0x00,0x00,0xFF,0xFF,0xBF,0xFF,0x3F,0x06,0x00,0x80,0xFF,0xFF,0xBF,0xFF,0xFF,0x00,0x00,0x80,0xFF,0xFF,0x01,0xF0,0xFF,0x07,0x00,0x80,0xFF,0x1F,0x1C,0xF7,0xFF,0x0F,0x00,0x00,0x3D,0x00,0x3E,0x6F,0xFC,0x1F,0x00,0x00,0x3C,0xFC,0x3F,0x4F,0x40,0x3F,0x00,0x00,0xFC,0xFF,0x3F,</span><br><span class="line">0x5F,0x80,0x3F,0x00,0x00,0xFC,0xFF,0x3F,0x4E,0x80,0x3F,0x00,0x00,0xF8,0xFF,0x1F,0x60,0x80,0x1F,0x00,0x00,0xF0,0xFF,0x07,0x30,0x00,0x07,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,</span><br><span class="line">0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/*C:\Users\NineSun\Desktop\未标题-1.bmp0*/</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">const int I2C_ADDR = 0x3c;              // oled屏幕的I2c地址</span><br><span class="line">#define SDA_PIN 12                       // SDA引脚，默认gpio12</span><br><span class="line">#define SCL_PIN 13                      // SCL引脚，默认gpio13</span><br><span class="line"></span><br><span class="line">SSD1306Wire oled(I2C_ADDR, SDA_PIN, SCL_PIN);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void setup()&#123;</span><br><span class="line">  pinMode(MIC, INPUT);      // 麦克风输入口</span><br><span class="line">  pinMode(LED, OUTPUT);     // LED输出口</span><br><span class="line">  pinMode(HC, INPUT);     // 红外输入</span><br><span class="line">  pinMode(D_in, INPUT);     // 光敏输入</span><br><span class="line">  pinMode(2,OUTPUT);</span><br><span class="line"></span><br><span class="line">  Serial.begin(115200);</span><br><span class="line">  </span><br><span class="line">  setup_wifi();</span><br><span class="line">  client.setServer(mqtt_server,1883);</span><br><span class="line">  client.setCallback(callback);</span><br><span class="line"></span><br><span class="line">  oled.init();</span><br><span class="line">  oled.flipScreenVertically();        // 设置屏幕翻转</span><br><span class="line">  oled.setContrast(255);              // 设置屏幕亮度</span><br><span class="line">  drawRect();                         // 测试屏幕显示</span><br><span class="line">  oled.clear(); </span><br><span class="line">  oled.display();       // 清除屏幕</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void loop()&#123;</span><br><span class="line">  if(!client.connected())&#123;</span><br><span class="line">    reconnect();</span><br><span class="line">  &#125;</span><br><span class="line">  client.loop();</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">  if(auto_mode)&#123;</span><br><span class="line">    oled.clear();</span><br><span class="line">    Auto_Mode();</span><br><span class="line">  &#125;</span><br><span class="line">  else&#123;</span><br><span class="line">    oled.clear();</span><br><span class="line">    oled.drawFastImage(30, 0, 64, 64, image2);</span><br><span class="line">    oled.display();</span><br><span class="line">    manual_mode();</span><br><span class="line">    delay(200);</span><br><span class="line">  &#125;</span><br><span class="line">      </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void Auto_Mode()&#123;</span><br><span class="line">  oled.setFont(ArialMT_Plain_16);       // 设置字体</span><br><span class="line">  oled.println(&quot;AUTO&quot;);</span><br><span class="line">  oled.drawFastImage(4 + 20*1, 21*0, 16, 16, sheng[0]); // 将要显示的文字写入缓存</span><br><span class="line">  oled.drawFastImage(4 + 20*1, 21*1, 16, 16, ren[0]); // 将要显示的文字写入缓存</span><br><span class="line">  oled.drawFastImage(4 + 20*1, 21*2, 16, 16, guang[0]); // 将要显示的文字写入缓存</span><br><span class="line">  oled.drawFastImage(4 + 20*0, 21*0, 16, 16, wu_you[VALOR]); // 将要显示的文字写入缓存</span><br><span class="line">  oled.drawFastImage(4 + 20*0, 21*1, 16, 16, wu_you[HoneWai]); // 将要显示的文字写入缓存</span><br><span class="line">  oled.drawFastImage(4 + 20*0, 21*2, 16, 16, wu_you[!Lighting]); // 将要显示的文字写入缓存</span><br><span class="line">  oled.drawFastImage(45, 0, 64, 64, image1);</span><br><span class="line">  oled.display();                       // 将缓存里的文字在屏幕上显示</span><br><span class="line">  delay(500);</span><br><span class="line">  oled.display();</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">  VALOR = digitalRead(MIC);   // 数字读取DO</span><br><span class="line">  HoneWai = digitalRead(HC); </span><br><span class="line">  Lighting =  digitalRead(D_in);</span><br><span class="line">  </span><br><span class="line">  if(Lighting==HIGH)&#123;</span><br><span class="line">    oled.clear();</span><br><span class="line">       if (VALOR == HIGH||HoneWai == HIGH)&#123;</span><br><span class="line">             oled.drawFastImage(4 + 20*1, 21*0, 16, 16, sheng[0]); // 将要显示的文字写入缓存</span><br><span class="line">             oled.drawFastImage(4 + 20*1, 21*1, 16, 16, ren[0]); // 将要显示的文字写入缓存</span><br><span class="line">             oled.drawFastImage(4 + 20*1, 21*2, 16, 16, guang[0]); // 将要显示的文字写入缓存</span><br><span class="line">             oled.drawFastImage(4 + 20*0, 21*0, 16, 16, wu_you[VALOR]); // 将要显示的文字写入缓存</span><br><span class="line">             oled.drawFastImage(4 + 20*0, 21*1, 16, 16, wu_you[HoneWai]); // 将要显示的文字写入缓存</span><br><span class="line">             oled.drawFastImage(4 + 20*0, 21*2, 16, 16, wu_you[!Lighting]); // 将要显示的文字写入缓存</span><br><span class="line"></span><br><span class="line">             oled.drawFastImage(45, 0, 64, 64, image1);</span><br><span class="line">             </span><br><span class="line">             oled.display();                       // 将缓存里的文字在屏幕上显示</span><br><span class="line">             digitalWrite(LED, HIGH);</span><br><span class="line">             delay(5000); </span><br><span class="line">           &#125;</span><br><span class="line">       else&#123;</span><br><span class="line">             digitalWrite(LED, LOW);</span><br><span class="line">           &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  else&#123;</span><br><span class="line">    digitalWrite(LED, LOW);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void manual_mode()&#123;</span><br><span class="line">  digitalWrite(LED, led_mode?HIGH:LOW);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//开机动画</span><br><span class="line">void drawRect(void) &#123;</span><br><span class="line">  for (int16_t i=0; i&lt;oled.getHeight()/2; i+=2) &#123;</span><br><span class="line">    oled.drawRect(i, i, oled.getWidth()-2*i, oled.getHeight()-2*i);</span><br><span class="line">    oled.display();</span><br><span class="line">    delay(50);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/*****************************wifi程序*****************************************************************/</span><br><span class="line">void setup_wifi()&#123;</span><br><span class="line">  Serial.println();</span><br><span class="line">  Serial.print(&quot;Connecting to&quot;);</span><br><span class="line">  Serial.println(wifissid);</span><br><span class="line">  WiFi.begin(wifissid,password);</span><br><span class="line">  while(WiFi.status()!=WL_CONNECTED)&#123;</span><br><span class="line">    delay(500);</span><br><span class="line">    Serial.print(&quot;.&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(&quot; &quot;);</span><br><span class="line">  Serial.println(&quot;WiFi connected!&quot;);</span><br><span class="line">  Serial.println(&quot;IP Address:&quot;);</span><br><span class="line">  Serial.println(WiFi.localIP());</span><br><span class="line">&#125;</span><br><span class="line">void callback(char* topic,byte* payload,unsigned int length)&#123;</span><br><span class="line">  String msg=&quot;&quot;;</span><br><span class="line">  String Led_set=&quot;&quot;;</span><br><span class="line">  String auto_set=&quot;&quot;;</span><br><span class="line">  Serial.println(&quot;Message arrived&#123;&quot;);</span><br><span class="line">  Serial.println(topic);</span><br><span class="line">  Serial.println(&quot;&#125;&quot;);</span><br><span class="line">  for (int i=0;i&lt;length;i++)&#123;</span><br><span class="line">    msg+=(char)payload[i];</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(msg);</span><br><span class="line">  if(msg.indexOf(&quot;led&quot;))&#123;</span><br><span class="line">    Led_set = msg.substring(msg.indexOf(&quot;led\&quot;:&quot;)+5,msg.indexOf(&quot;&#125;&quot;));</span><br><span class="line">    led_mode = Led_set.toInt();</span><br><span class="line">  &#125;</span><br><span class="line">  if(msg.indexOf(&quot;auto&quot;))&#123;</span><br><span class="line">    auto_set = msg.substring(msg.indexOf(&quot;auto\&quot;:&quot;)+6,msg.indexOf(&quot;&#125;&quot;));</span><br><span class="line">    auto_mode = auto_set.toInt();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">void reconnect()&#123;</span><br><span class="line">  while(!client.connected())&#123;</span><br><span class="line">    Serial.println(&quot;Attempting MQTT connection...&quot;);</span><br><span class="line">    if(client.connect(mqtt_id))&#123;</span><br><span class="line">      Serial.println(&quot;Connected!&quot;);</span><br><span class="line">      client.publish(Mqtt_pub_topic,&quot;设备已上线&quot;);</span><br><span class="line"></span><br><span class="line">      client.subscribe(Mqtt_sub_topic,1);</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">      Serial.println(&quot;Failed,rc=&quot;);</span><br><span class="line">      Serial.println(client.state());</span><br><span class="line">      Serial.println(&quot;try again in 5 seconds&quot;);</span><br><span class="line">      delay(50000);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">````  </span><br><span class="line">* 代码中的中文汉字用到了一个叫 ```PCtoLCD2002``` 的软件,这个软件可以很方便的将汉字转化成对应的字形码来输出，这里用的是```16*16```的字宽字长；**</span><br><span class="line">* 关于Mqtt通信协议的获取的相关函数写在了wifi相关里面；</span><br><span class="line">* 关于```const char* mqtt_server=&quot;xxx.xxx.xxx.xxx&quot;;```这句话中的```xxx.xxx.xxx.xxx```应该填入你的物联网服务器公网地址，关于如何搭建物联网服务器，我有计划重新开一篇帖子来说，非常简单，如果你是学生的话更能用几十块钱的价格买到非常便宜的云服务器，平时学习使用是足够了的。</span><br><span class="line">* ``client.setServer(mqtt_server,1883);``一句中的``1883``是服务器端口号，通常设置为1883；  </span><br><span class="line"></span><br><span class="line">接下来是软件方面的代码，软件开发使用**AndroidStudio**进行，首先需要添加MQTT的依赖库，然后app还需要获取一些必要的权限，这些都是必须要配置的：  </span><br><span class="line"></span><br><span class="line">**首先**，在bulid.gradle 里面最后的依赖那里复制这段代码（在那一排“implementation”后面加）</span><br></pre></td></tr></table></figure><p>//导入Mqtt环境依赖<br>    implementation ‘org.eclipse.paho:org.eclipse.paho.client.mqttv3:1.1.1’<br>    implementation ‘org.eclipse.paho:org.eclipse.paho.android.service:1.1.1’</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">然后软件点击右上角的sync now，进行同步，建议科学上网，就能正常加载包了;</span><br><span class="line"></span><br><span class="line">**然后**，需要配置app需要的一些权限：找到```AndroidManifest.xml```文件，在这个文件中加入：</span><br></pre></td></tr></table></figure> <!-- Permissions the Application Requires --><pre><code>&lt;uses-permission android:name=&quot;android.permission.WAKE_LOCK&quot; /&gt;&lt;uses-permission android:name=&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot; /&gt;&lt;uses-permission android:name=&quot;android.permission.ACCESS_NETWORK_STATE&quot; /&gt;&lt;!--&lt;uses-permission android:name=&quot;android.permission.READ_PHONE_STATE&quot; /&gt;--&gt;&lt;uses-permission android:name=&quot;android.permission.READ_EXTERNAL_STORAGE&quot; /&gt;&lt;uses-permission android:name=&quot;android.permission.INTERNET&quot; /&gt;</code></pre><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">为防止有的同学完全没接触过as开发，特别说明，这段直接添加到原代码的``` &lt;application```之前就可以了，就在前面几行，很容易找到。</span><br><span class="line"></span><br><span class="line">**最后**，还是在这个文件中，在代码末尾```&lt;/activity&gt;```这句话的后面，紧跟着插入一段</span><br></pre></td></tr></table></figure> <!-- Mqtt Service --><pre><code>    &lt;service android:name=&quot;org.eclipse.paho.android.service.MqttService&quot;&gt;    &lt;/service&gt;</code></pre><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">来引入Mqt的服务。  </span><br><span class="line">**完成之后，前期的配置就完成了可以愉快的写代码了(≧∇≦)ﾉ。**  </span><br><span class="line">程序逻辑代码：</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>package com.example.mqtt_study;</p><p>import androidx.appcompat.app.AppCompatActivity;</p><p>import android.os.Bundle;<br>import android.view.View;<br>import android.widget.Button;<br>import android.widget.ImageButton;<br>import android.widget.ImageView;<br>import android.widget.LinearLayout;<br>import android.widget.TextView;<br>import android.widget.Toast;<br>import android.widget.Switch;</p><p>import org.eclipse.paho.android.service.MqttAndroidClient;<br>import org.eclipse.paho.client.mqttv3.IMqttActionListener;<br>import org.eclipse.paho.client.mqttv3.IMqttDeliveryToken;<br>import org.eclipse.paho.client.mqttv3.IMqttMessageListener;<br>import org.eclipse.paho.client.mqttv3.IMqttToken;<br>import org.eclipse.paho.client.mqttv3.MqttCallbackExtended;<br>import org.eclipse.paho.client.mqttv3.MqttConnectOptions;<br>import org.eclipse.paho.client.mqttv3.MqttException;<br>import org.eclipse.paho.client.mqttv3.MqttMessage;</p><p>public class MainActivity extends AppCompatActivity {</p><pre><code>MqttAndroidClient mqttAndroidClient;//建立Client客户端实例final String serverUri = &quot;tcp://101.43.207.139:1883&quot;;//服务器地址String clientId = &quot;isNineSun_android&quot;;//客户端标识，可以随便起，保证不重复即可final String subscriptionTopic = &quot;sub_ywt&quot;;//订阅的主题final String publishTopic = &quot;pub_ywt&quot;;//UI变量private ImageButton button1,button2;private boolean light,auto;private TextView text;private ImageView image;@Overrideprotected void onCreate(Bundle savedInstanceState) &#123;    super.onCreate(savedInstanceState);    setContentView(R.layout.activity_main);    UI_init();    Mqtt_init();    button1.setOnClickListener(new View.OnClickListener() &#123;        @Override        public void onClick(View view) &#123;            light=!light;            String publishMsg=&quot;&#123;\&quot;set_led\&quot;:&quot;+(light?&quot;1&quot;:&quot;0&quot;)+&quot;&#125;&quot;;            publishMessage(publishMsg);        &#125;    &#125;);    button2.setOnClickListener(new View.OnClickListener() &#123;        @Override        public void onClick(View view) &#123;            auto=!auto;            String publishMsg=&quot;&#123;\&quot;set_auto\&quot;:&quot;+(auto?&quot;1&quot;:&quot;0&quot;)+&quot;&#125;&quot;;            publishMessage(publishMsg);        &#125;    &#125;);&#125;void UI_init()&#123;    button1 = findViewById(R.id.but_1);    button2 = findViewById(R.id.but_2);&#125;public void Mqtt_init()&#123;    //新建Client实例    //clientId = clientId + System.currentTimeMillis();//在clientId即客户端标识后面加上时间戳来保证唯一性    mqttAndroidClient = new MqttAndroidClient(getApplicationContext(), serverUri, clientId);    //新建回调函数    mqttAndroidClient.setCallback(new MqttCallbackExtended() &#123;        @Override        //连接完成        public void connectComplete(boolean reconnect, String serverURI) &#123;        &#125;        //失去连接        @Override        public void connectionLost(Throwable cause) &#123;        &#125;        //信息送达        @Override        public void messageArrived(String topic, MqttMessage message) throws Exception &#123;            String msg = new String(message.getPayload());            //String T_val=msg.substring(msg.indexOf(&quot;&#123;temperature:&quot;),msg.indexOf(&quot;&#125;&quot;));            makeToast(msg);            text.setText(msg);            image.setImageAlpha(1);        &#125;        //推送完成        @Override        public void deliveryComplete(IMqttDeliveryToken token) &#123;        &#125;    &#125;);    //连接设置、是否自动重连、是否清理Session    MqttConnectOptions mqttConnectOptions = new MqttConnectOptions();    mqttConnectOptions.setAutomaticReconnect(true);    mqttConnectOptions.setCleanSession(false);    //正式开始建立连接    try &#123;        //addToHistory(&quot;Connecting to &quot; + serverUri);        mqttAndroidClient.connect(mqttConnectOptions, null, new IMqttActionListener() &#123;            @Override            public void onSuccess(IMqttToken asyncActionToken) &#123;                makeToast(&quot;连接成功&quot;);                subscribeToTopic();            &#125;            @Override            public void onFailure(IMqttToken asyncActionToken, Throwable exception) &#123;                makeToast(&quot;连接失败&quot;);            &#125;        &#125;);    &#125; catch (MqttException ex)&#123;        ex.printStackTrace();    &#125;&#125;public void subscribeToTopic()&#123;    try &#123;        //开始订阅        mqttAndroidClient.subscribe(subscriptionTopic, 0, null, new IMqttActionListener() &#123;            @Override            public void onSuccess(IMqttToken asyncActionToken) &#123;                makeToast(&quot;成功订阅&quot;+subscriptionTopic);            &#125;            @Override            public void onFailure(IMqttToken asyncActionToken, Throwable exception) &#123;                makeToast(&quot;未能订阅&quot;+subscriptionTopic);            &#125;        &#125;);    &#125; catch (MqttException ex)&#123;        ex.printStackTrace();    &#125;&#125;public void publishMessage(String publishMessage)&#123;    try &#123;        MqttMessage message = new MqttMessage();        message.setPayload(publishMessage.getBytes());        mqttAndroidClient.publish(publishTopic, message);        if(!mqttAndroidClient.isConnected())&#123;        &#125;    &#125; catch (MqttException e) &#123;        System.err.println(&quot;Error Publishing: &quot; + e.getMessage());        e.printStackTrace();    &#125;&#125;private void makeToast(String str)&#123;    Toast.makeText(MainActivity.this,str,Toast.LENGTH_SHORT).show();&#125;</code></pre><p>}</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">软件的布局文件：</span><br></pre></td></tr></table></figure><?xml version="1.0" encoding="utf-8"?><p>&lt;androidx.constraintlayout.widget.ConstraintLayout xmlns:android=”<a href="http://schemas.android.com/apk/res/android&quot;">http://schemas.android.com/apk/res/android&quot;</a><br>    xmlns:app=”<a href="http://schemas.android.com/apk/res-auto&quot;">http://schemas.android.com/apk/res-auto&quot;</a><br>    xmlns:tools=”<a href="http://schemas.android.com/tools&quot;">http://schemas.android.com/tools&quot;</a><br>    android:layout_width=”match_parent”<br>    android:layout_height=”match_parent”<br>    tools:context=”.MainActivity”&gt;</p><pre><code>&lt;LinearLayout    android:layout_width=&quot;match_parent&quot;    android:layout_height=&quot;match_parent&quot;    android:orientation=&quot;vertical&quot;&gt;    &lt;LinearLayout        android:layout_width=&quot;match_parent&quot;        android:layout_height=&quot;wrap_content&quot;        android:visibility=&quot;visible&quot;&gt;        &lt;ImageView            android:layout_width=&quot;wrap_content&quot;            android:layout_height=&quot;20sp&quot;            android:src=&quot;@drawable/online&quot;            android:alpha=&quot;0&quot;&gt;        &lt;/ImageView&gt;        &lt;TextView            android:layout_width=&quot;wrap_content&quot;            android:layout_height=&quot;wrap_content&quot;            android:text=&quot;&quot;&gt;        &lt;/TextView&gt;    &lt;/LinearLayout&gt;    &lt;ImageButton        android:layout_width=&quot;100dp&quot;        android:layout_height=&quot;100dp&quot;        android:layout_gravity=&quot;center&quot;        android:layout_marginTop=&quot;200dp&quot;        android:id=&quot;@+id/but_1&quot;        android:backgroundTint=&quot;@color/white&quot;        android:src=&quot;@drawable/power&quot;&gt;    &lt;/ImageButton&gt;    &lt;ImageButton        android:layout_width=&quot;100dp&quot;        android:layout_height=&quot;100dp&quot;        android:layout_gravity=&quot;center&quot;        android:id=&quot;@+id/but_2&quot;        android:backgroundTint=&quot;@color/white&quot;        android:src=&quot;@drawable/swt&quot;&gt;    &lt;/ImageButton&gt;&lt;/LinearLayout&gt;</code></pre><p>&lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;</p><pre><code>程序代码我用了自己写的模板来节省开发时间，如果有人对我的模板感兴趣可以去我的github页面去拿，欢迎使用[Mqtt模板代码](https://github.com/isNineSun/isNineSun.github.io)！  ---## 五、实物图实物展示：![硬件.png](http://tva1.sinaimg.cn/large/008ruEzYly1gzgmkr2icdj30gy0ddwkp.jpg)![软件.png](http://tva1.sinaimg.cn/large/008ruEzYly1gzgmkr2um1j30gv0owwiq.jpg)  ---## 总结这次设计的硬件方面与之前的物联网设计大同小异，但是在Mqtt的配置方面学到了很多，也加深了对互联网概念的理解，以后有机会希望还能更深入更底层的去做物联网相关的开发，除此之外，AndroidStudio的开发我暂时也只是初窥门径而已，希望能更深入的掌握这个强大的工具，之后有机会我可能会做一些更偏软或者纯软的项目来加深对as开发的掌握。</code></pre>]]></content>
    
    
    <summary type="html">这是一个城市智能路灯控制系统的设计，实现功能主要为光线充足时不亮灯，当光线不足时开始检测，如果有人或者有声音便亮起路灯，这是自动模式，设备可通过手机APP切换为手动模式，在手动模式下用户可通过手机APP来实现对路灯的操控。</summary>
    
    
    
    <category term="设计开发" scheme="http://yoursite.com/categories/%E8%AE%BE%E8%AE%A1%E5%BC%80%E5%8F%91/"/>
    
    <category term="嵌入式" scheme="http://yoursite.com/categories/%E8%AE%BE%E8%AE%A1%E5%BC%80%E5%8F%91/%E5%B5%8C%E5%85%A5%E5%BC%8F/"/>
    
    
    <category term="嵌入式开发" scheme="http://yoursite.com/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/"/>
    
    <category term="Mqtt" scheme="http://yoursite.com/tags/Mqtt/"/>
    
  </entry>
  
  <entry>
    <title>Esp8266配置Wifi连接模板</title>
    <link href="http://yoursite.com/2022/02/01/ESP8266_template/"/>
    <id>http://yoursite.com/2022/02/01/ESP8266_template/</id>
    <published>2022-02-01T09:58:04.000Z</published>
    <updated>2023-11-01T17:53:27.363Z</updated>
    
    <content type="html"><![CDATA[<h2 id="模板"><a href="#模板" class="headerlink" title="模板"></a>模板</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ESP8266WiFi.h&gt;</span>        </span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span>* ssid=<span class="string">&quot;WiFi名称&quot;</span>;      </span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span>* password=<span class="string">&quot;WiFi密码&quot;</span>;         </span><br><span class="line">                                            </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  Serial.<span class="built_in">begin</span>(<span class="number">9600</span>);          <span class="comment">// 启动串口通讯</span></span><br><span class="line"> </span><br><span class="line">  </span><br><span class="line">  <span class="keyword">int</span> i = <span class="number">0</span>;                                 </span><br><span class="line">  WiFi.<span class="built_in">begin</span>(ssid,password);</span><br><span class="line">    <span class="keyword">while</span>(WiFi.<span class="built_in">status</span>()!= WL_CONNECTED)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">delay</span>(<span class="number">500</span>);</span><br><span class="line">        Serial.<span class="built_in">print</span>(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">  <span class="comment">// WiFi连接成功后将通过串口监视器输出连接成功信息 </span></span><br><span class="line">  Serial.<span class="built_in">println</span>(<span class="string">&#x27;\n&#x27;</span>);                     <span class="comment">// WiFi连接成功后</span></span><br><span class="line">  Serial.<span class="built_in">print</span>(<span class="string">&quot;Connected to &quot;</span>);            <span class="comment">// NodeMCU将通过串口监视器输出。</span></span><br><span class="line">  Serial.<span class="built_in">println</span>(WiFi.<span class="built_in">SSID</span>());              <span class="comment">// 连接的WiFI名称</span></span><br><span class="line">  Serial.<span class="built_in">print</span>(<span class="string">&quot;IP address:\t&quot;</span>);            <span class="comment">// 以及</span></span><br><span class="line">  Serial.<span class="built_in">println</span>(WiFi.<span class="built_in">localIP</span>());           <span class="comment">// NodeMCU的IP地址</span></span><br><span class="line">  &#125;  </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">loop</span><span class="params">()</span> </span>&#123;                                   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">这是一个ESP8266连接wifi的模板，几乎连接wifi都会用到这个代码，因此在这里做个记录。</summary>
    
    
    
    <category term="学习记录" scheme="http://yoursite.com/categories/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"/>
    
    <category term="模板记录" scheme="http://yoursite.com/categories/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/%E6%A8%A1%E6%9D%BF%E8%AE%B0%E5%BD%95/"/>
    
    
    <category term="学习" scheme="http://yoursite.com/tags/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="记录" scheme="http://yoursite.com/tags/%E8%AE%B0%E5%BD%95/"/>
    
  </entry>
  
  <entry>
    <title>基于ESP的农业气象监测站</title>
    <link href="http://yoursite.com/2022/01/23/AgricultureMonitor/"/>
    <id>http://yoursite.com/2022/01/23/AgricultureMonitor/</id>
    <published>2022-01-23T11:01:04.000Z</published>
    <updated>2023-11-01T17:27:59.952Z</updated>
    
    <content type="html"><![CDATA[<h2 id="一、原件清单"><a href="#一、原件清单" class="headerlink" title="一、原件清单"></a>一、原件清单</h2><ul><li>esp8266 node-mcu*1  </li><li>ssd1302 oled显示屏*1</li><li>dht11温湿度传感器*1</li><li>bmp280气压传感器*1</li><li>风速传感器（淘宝店铺：<a href="ilovemcu.taobao.com/">风速传感器的店铺</a>)  </li><li>2pin接线端子*1</li><li>杜邦线 若干  </li></ul><hr><h2 id="二、硬件连接"><a href="#二、硬件连接" class="headerlink" title="二、硬件连接"></a>二、硬件连接</h2><p><img src="http://tva1.sinaimg.cn/large/008ruEzYly1gynqmp1852j310x0k4qgr.jpg" alt="连线图.png"><br>连线图  </p><table><thead><tr><th>NodeMCU</th><th>ssd1306</th><th>dht11</th><th>BMP280</th><th>风速传感器</th></tr></thead><tbody><tr><td>D0</td><td></td><td></td><td>SCL</td><td></td></tr><tr><td>D1</td><td>SCL</td><td></td><td></td><td></td></tr><tr><td>D2</td><td>SDA</td><td></td><td></td><td></td></tr><tr><td>D3</td><td></td><td></td><td></td><td></td></tr><tr><td>D4</td><td></td><td>S</td><td></td><td></td></tr><tr><td>D5</td><td></td><td></td><td>SDO</td><td></td></tr><tr><td>D6</td><td></td><td></td><td>CSB</td><td></td></tr><tr><td>D7</td><td></td><td></td><td>SDA</td><td></td></tr><tr><td>A0</td><td></td><td></td><td></td><td>棕色信号线</td></tr><tr><td></td><td></td><td></td><td></td><td></td></tr><tr><td><strong>PS：各个模块的VCC和GNG端口皆并联在由NodeMCU引出的3v3和gnd上，风速传感器的蓝色线为gnd线，连接在NodeMCU的GND端口上</strong></td><td></td><td></td><td></td><td></td></tr></tbody></table><hr><h2 id="三、原理框图"><a href="#三、原理框图" class="headerlink" title="三、原理框图"></a>三、原理框图</h2><p><img src="http://tva1.sinaimg.cn/large/008ruEzYly1gynsdcctwnj30lf0bp0ti.jpg" alt="农业气象监测站原理图.png">  </p><p>通过wifi的方式来将数据传回手机。</p><hr><h2 id="四、程序代码"><a href="#四、程序代码" class="headerlink" title="四、程序代码"></a>四、程序代码</h2><p>废话少说直接上代码  </p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Wire.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;SPI.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Adafruit_Sensor.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Adafruit_BMP280.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;dht11.h&gt;</span><span class="comment">//引入DHT11库</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;SSD1306Wire.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BLINKER_WIFI</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Blinker.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> temNumber <span class="meta-string">&quot;num-gpc&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> humNumber <span class="meta-string">&quot;num-ia5&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> windNumber <span class="meta-string">&quot;num-zb4&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> AirNumber <span class="meta-string">&quot;num-3zw&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> auth[] = <span class="string">&quot;c2b25ef0c332&quot;</span>;</span><br><span class="line"><span class="keyword">char</span> ssid[] = <span class="string">&quot;皇室家族Family&quot;</span>;</span><br><span class="line"><span class="keyword">char</span> pswd[] = <span class="string">&quot;sunlisunrusunxu@&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function">BlinkerNumber <span class="title">Tem</span><span class="params">(temNumber)</span></span>;</span><br><span class="line"><span class="function">BlinkerNumber <span class="title">Hum</span><span class="params">(humNumber)</span></span>;</span><br><span class="line"><span class="function">BlinkerNumber <span class="title">Wind</span><span class="params">(windNumber)</span></span>;</span><br><span class="line"><span class="function">BlinkerNumber <span class="title">Air</span><span class="params">(AirNumber)</span></span>;</span><br><span class="line"></span><br><span class="line">dht11 DHT11;<span class="comment">//定义传感器类型</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DHT11PIN 2<span class="comment">//定义传感器连接引脚。此处的PIN2在NodeMcu8266开发板上对应的引脚是D4</span></span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> I2C_ADDR = <span class="number">0x3c</span>;              <span class="comment">// oled屏幕的I2c地址</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SDA_PIN 4                       <span class="comment">// SDA引脚，默认gpio4(D2)</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SCL_PIN 5                       <span class="comment">// SCL引脚，默认gpio5(D1)</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BMP_SCK 16</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BMP_MISO 14</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BMP_MOSI 13 </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BMP_CS 12                      <span class="comment">//气压传感器引脚定义</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">SSD1306Wire <span class="title">oled</span><span class="params">(I2C_ADDR, SDA_PIN, SCL_PIN)</span></span>;</span><br><span class="line"><span class="function">Adafruit_BMP280 <span class="title">bmp</span><span class="params">(BMP_CS, BMP_MOSI, BMP_MISO,  BMP_SCK)</span></span>;</span><br><span class="line">String number[]=&#123;<span class="string">&quot;0&quot;</span>,<span class="string">&quot;1&quot;</span>,<span class="string">&quot;2&quot;</span>,<span class="string">&quot;3&quot;</span>,<span class="string">&quot;4&quot;</span>,<span class="string">&quot;5&quot;</span>,<span class="string">&quot;6&quot;</span>,<span class="string">&quot;7&quot;</span>,<span class="string">&quot;8&quot;</span>,<span class="string">&quot;9&quot;</span>&#125;;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">uint8_t</span> text[][<span class="number">32</span>]=&#123;</span><br><span class="line"><span class="number">0x10</span>,<span class="number">0x04</span>,<span class="number">0x60</span>,<span class="number">0x04</span>,<span class="number">0x02</span>,<span class="number">0x7E</span>,<span class="number">0x8C</span>,<span class="number">0x01</span>,<span class="number">0x00</span>,<span class="number">0x40</span>,<span class="number">0x00</span>,<span class="number">0x7E</span>,<span class="number">0xFE</span>,<span class="number">0x42</span>,<span class="number">0x92</span>,<span class="number">0x42</span>,<span class="number">0x92</span>,<span class="number">0x7E</span>,<span class="number">0x92</span>,<span class="number">0x42</span>,<span class="number">0x92</span>,<span class="number">0x7E</span>,<span class="number">0x92</span>,<span class="number">0x42</span>,<span class="number">0xFE</span>,<span class="number">0x42</span>,<span class="number">0x00</span>,<span class="number">0x7E</span>,<span class="number">0x00</span>,<span class="number">0x40</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="comment">/*&quot;温&quot;,0*/</span></span><br><span class="line"><span class="number">0x00</span>,<span class="number">0x40</span>,<span class="number">0x00</span>,<span class="number">0x30</span>,<span class="number">0xFC</span>,<span class="number">0x8F</span>,<span class="number">0x24</span>,<span class="number">0x80</span>,<span class="number">0x24</span>,<span class="number">0x84</span>,<span class="number">0x24</span>,<span class="number">0x4C</span>,<span class="number">0xFC</span>,<span class="number">0x55</span>,<span class="number">0x25</span>,<span class="number">0x25</span>,<span class="number">0x26</span>,<span class="number">0x25</span>,<span class="number">0x24</span>,<span class="number">0x25</span>,<span class="number">0xFC</span>,<span class="number">0x55</span>,<span class="number">0x24</span>,<span class="number">0x4C</span>,<span class="number">0x24</span>,<span class="number">0x80</span>,<span class="number">0x24</span>,<span class="number">0x80</span>,<span class="number">0x04</span>,<span class="number">0x80</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="comment">/*&quot;度&quot;,1*/</span></span><br><span class="line"><span class="number">0x10</span>,<span class="number">0x04</span>,<span class="number">0x60</span>,<span class="number">0x04</span>,<span class="number">0x02</span>,<span class="number">0x7E</span>,<span class="number">0x8C</span>,<span class="number">0x01</span>,<span class="number">0x00</span>,<span class="number">0x44</span>,<span class="number">0xFE</span>,<span class="number">0x48</span>,<span class="number">0x92</span>,<span class="number">0x50</span>,<span class="number">0x92</span>,<span class="number">0x7F</span>,<span class="number">0x92</span>,<span class="number">0x40</span>,<span class="number">0x92</span>,<span class="number">0x40</span>,<span class="number">0x92</span>,<span class="number">0x7F</span>,<span class="number">0x92</span>,<span class="number">0x50</span>,<span class="number">0xFE</span>,<span class="number">0x48</span>,<span class="number">0x00</span>,<span class="number">0x44</span>,<span class="number">0x00</span>,<span class="number">0x40</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="comment">/*&quot;湿&quot;,2*/</span></span><br><span class="line"><span class="number">0x00</span>,<span class="number">0x40</span>,<span class="number">0x00</span>,<span class="number">0x30</span>,<span class="number">0xFC</span>,<span class="number">0x8F</span>,<span class="number">0x24</span>,<span class="number">0x80</span>,<span class="number">0x24</span>,<span class="number">0x84</span>,<span class="number">0x24</span>,<span class="number">0x4C</span>,<span class="number">0xFC</span>,<span class="number">0x55</span>,<span class="number">0x25</span>,<span class="number">0x25</span>,<span class="number">0x26</span>,<span class="number">0x25</span>,<span class="number">0x24</span>,<span class="number">0x25</span>,<span class="number">0xFC</span>,<span class="number">0x55</span>,<span class="number">0x24</span>,<span class="number">0x4C</span>,<span class="number">0x24</span>,<span class="number">0x80</span>,<span class="number">0x24</span>,<span class="number">0x80</span>,<span class="number">0x04</span>,<span class="number">0x80</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="comment">/*&quot;度&quot;,3*/</span></span><br><span class="line"><span class="number">0x00</span>,<span class="number">0x80</span>,<span class="number">0x00</span>,<span class="number">0x60</span>,<span class="number">0xFE</span>,<span class="number">0x1F</span>,<span class="number">0x02</span>,<span class="number">0x00</span>,<span class="number">0x12</span>,<span class="number">0x20</span>,<span class="number">0x22</span>,<span class="number">0x10</span>,<span class="number">0xC2</span>,<span class="number">0x0C</span>,<span class="number">0x02</span>,<span class="number">0x03</span>,<span class="number">0xC2</span>,<span class="number">0x0C</span>,<span class="number">0x32</span>,<span class="number">0x30</span>,<span class="number">0x02</span>,<span class="number">0x00</span>,<span class="number">0xFE</span>,<span class="number">0x0F</span>,<span class="number">0x00</span>,<span class="number">0x30</span>,<span class="number">0x00</span>,<span class="number">0x40</span>,<span class="number">0x00</span>,<span class="number">0xF8</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="comment">/*&quot;风&quot;,4*/</span></span><br><span class="line"><span class="number">0x40</span>,<span class="number">0x00</span>,<span class="number">0x40</span>,<span class="number">0x40</span>,<span class="number">0x42</span>,<span class="number">0x20</span>,<span class="number">0xCC</span>,<span class="number">0x1F</span>,<span class="number">0x00</span>,<span class="number">0x20</span>,<span class="number">0x04</span>,<span class="number">0x48</span>,<span class="number">0xF4</span>,<span class="number">0x44</span>,<span class="number">0x94</span>,<span class="number">0x42</span>,<span class="number">0x94</span>,<span class="number">0x41</span>,<span class="number">0xFF</span>,<span class="number">0x5F</span>,<span class="number">0x94</span>,<span class="number">0x41</span>,<span class="number">0x94</span>,<span class="number">0x42</span>,<span class="number">0xF4</span>,<span class="number">0x44</span>,<span class="number">0x04</span>,<span class="number">0x48</span>,<span class="number">0x00</span>,<span class="number">0x40</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="comment">/*&quot;速&quot;,5*/</span></span><br><span class="line"><span class="number">0x20</span>,<span class="number">0x00</span>,<span class="number">0x10</span>,<span class="number">0x00</span>,<span class="number">0x4C</span>,<span class="number">0x00</span>,<span class="number">0x47</span>,<span class="number">0x00</span>,<span class="number">0x54</span>,<span class="number">0x00</span>,<span class="number">0x54</span>,<span class="number">0x00</span>,<span class="number">0x54</span>,<span class="number">0x00</span>,<span class="number">0x54</span>,<span class="number">0x00</span>,<span class="number">0x54</span>,<span class="number">0x00</span>,<span class="number">0x54</span>,<span class="number">0x00</span>,<span class="number">0x54</span>,<span class="number">0x00</span>,<span class="number">0xD4</span>,<span class="number">0x0F</span>,<span class="number">0x04</span>,<span class="number">0x30</span>,<span class="number">0x04</span>,<span class="number">0x40</span>,<span class="number">0x00</span>,<span class="number">0xF0</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="comment">/*&quot;气&quot;,6*/</span></span><br><span class="line"><span class="number">0x00</span>,<span class="number">0x80</span>,<span class="number">0x00</span>,<span class="number">0x60</span>,<span class="number">0xFE</span>,<span class="number">0x1F</span>,<span class="number">0x02</span>,<span class="number">0x40</span>,<span class="number">0x82</span>,<span class="number">0x40</span>,<span class="number">0x82</span>,<span class="number">0x40</span>,<span class="number">0x82</span>,<span class="number">0x40</span>,<span class="number">0x82</span>,<span class="number">0x40</span>,<span class="number">0xFA</span>,<span class="number">0x7F</span>,<span class="number">0x82</span>,<span class="number">0x40</span>,<span class="number">0x82</span>,<span class="number">0x40</span>,<span class="number">0x82</span>,<span class="number">0x44</span>,<span class="number">0x82</span>,<span class="number">0x58</span>,<span class="number">0x82</span>,<span class="number">0x40</span>,<span class="number">0x02</span>,<span class="number">0x40</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="comment">/*&quot;压&quot;,7*/</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">float</span> wind=<span class="number">0.0</span>;</span><br><span class="line"><span class="keyword">float</span> wind_value=<span class="number">0.0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  Serial.<span class="built_in">begin</span>(<span class="number">9600</span>);<span class="comment">//设置波特率为115200</span></span><br><span class="line"></span><br><span class="line">  Blinker.<span class="built_in">begin</span>(auth, ssid, pswd);  </span><br><span class="line"></span><br><span class="line">  oled.<span class="built_in">init</span>();                        <span class="comment">//初始化</span></span><br><span class="line">  oled.<span class="built_in">flipScreenVertically</span>();        <span class="comment">// 设置屏幕翻转</span></span><br><span class="line">  oled.<span class="built_in">setContrast</span>(<span class="number">255</span>);              <span class="comment">// 设置屏幕亮度</span></span><br><span class="line">  <span class="built_in">drawRect</span>();                         <span class="comment">// 测试屏幕显示</span></span><br><span class="line">  oled.<span class="built_in">clear</span>(); oled.<span class="built_in">display</span>();       <span class="comment">// 清除屏幕</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/********************###主函数###********************/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">loop</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  Blinker.<span class="built_in">run</span>();</span><br><span class="line">  bmp.<span class="built_in">begin</span>();</span><br><span class="line">  Serial.<span class="built_in">println</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">  DHT11.<span class="built_in">read</span>(DHT11PIN); <span class="comment">//更新传感器所有信息</span></span><br><span class="line">  <span class="built_in">delay</span>(<span class="number">500</span>);<span class="comment">//每0.5秒打印一次</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">int</span> sensorValue = <span class="built_in">analogRead</span>(A0);</span><br><span class="line">  <span class="keyword">float</span> wind = sensorValue * (<span class="number">5.0</span> / <span class="number">1024.0</span>); </span><br><span class="line">  wind_value=<span class="number">100</span>*wind<span class="number">-4.39</span>;</span><br><span class="line">  </span><br><span class="line">  oled.<span class="built_in">setFont</span>(ArialMT_Plain_16);     <span class="comment">// 设置字体</span></span><br><span class="line">  oled.<span class="built_in">clear</span>();</span><br><span class="line">  oled.<span class="built_in">drawFastImage</span>(<span class="number">4</span> + <span class="number">16</span>*<span class="number">0</span>, <span class="number">0</span>, <span class="number">16</span>, <span class="number">16</span>, text[<span class="number">0</span>]);</span><br><span class="line">  oled.<span class="built_in">drawFastImage</span>(<span class="number">4</span> + <span class="number">16</span>*<span class="number">1</span>, <span class="number">0</span>, <span class="number">16</span>, <span class="number">16</span>, text[<span class="number">1</span>]);</span><br><span class="line">  oled.<span class="built_in">drawFastImage</span>(<span class="number">18</span> + <span class="number">16</span>*<span class="number">3</span>, <span class="number">0</span>, <span class="number">16</span>, <span class="number">16</span>, text[<span class="number">2</span>]);</span><br><span class="line">  oled.<span class="built_in">drawFastImage</span>(<span class="number">18</span> + <span class="number">16</span>*<span class="number">4</span>, <span class="number">0</span>, <span class="number">16</span>, <span class="number">16</span>, text[<span class="number">3</span>]);</span><br><span class="line">  oled.<span class="built_in">drawFastImage</span>(<span class="number">4</span> + <span class="number">16</span>*<span class="number">0</span>, <span class="number">19</span>, <span class="number">16</span>, <span class="number">16</span>, text[<span class="number">4</span>]);</span><br><span class="line">  oled.<span class="built_in">drawFastImage</span>(<span class="number">4</span> + <span class="number">16</span>*<span class="number">1</span>, <span class="number">19</span>, <span class="number">16</span>, <span class="number">16</span>, text[<span class="number">5</span>]);</span><br><span class="line">  oled.<span class="built_in">drawFastImage</span>(<span class="number">4</span> + <span class="number">16</span>*<span class="number">0</span>, <span class="number">19</span>*<span class="number">2</span>, <span class="number">16</span>, <span class="number">16</span>, text[<span class="number">6</span>]);</span><br><span class="line">  oled.<span class="built_in">drawFastImage</span>(<span class="number">4</span> + <span class="number">16</span>*<span class="number">1</span>, <span class="number">19</span>*<span class="number">2</span>, <span class="number">16</span>, <span class="number">16</span>, text[<span class="number">7</span>]);</span><br><span class="line">  oled.<span class="built_in">drawString</span>(<span class="number">4</span> + <span class="number">16</span>*<span class="number">2</span>, <span class="number">0</span>, <span class="string">&quot;:&quot;</span>+number[DHT11.temperature/<span class="number">10</span>]+number[DHT11.temperature%<span class="number">10</span>]);</span><br><span class="line">  oled.<span class="built_in">drawString</span>(<span class="number">18</span> + <span class="number">16</span>*<span class="number">5</span>, <span class="number">0</span>, <span class="string">&quot;:&quot;</span>+number[DHT11.humidity/<span class="number">10</span>]+number[DHT11.humidity%<span class="number">10</span>]);</span><br><span class="line">  oled.<span class="built_in">drawString</span>(<span class="number">4</span> + <span class="number">16</span>*<span class="number">2</span>, <span class="number">19</span>, <span class="string">&quot;:&quot;</span>+number[(<span class="keyword">int</span>)wind_value/<span class="number">100</span>]+number[(<span class="keyword">int</span>)wind_value/<span class="number">10</span>%<span class="number">10</span>]+number[(<span class="keyword">int</span>)wind_value%<span class="number">10</span>]+<span class="string">&quot;.&quot;</span>+number[((<span class="keyword">int</span>)(wind_value*<span class="number">100</span>))/<span class="number">10</span>%<span class="number">10</span>]+number[((<span class="keyword">int</span>)(wind_value*<span class="number">100</span>))%<span class="number">10</span>]+<span class="string">&quot;km/h&quot;</span>);</span><br><span class="line">  <span class="built_in">pressuCheck</span>();</span><br><span class="line">  oled.<span class="built_in">display</span>(); </span><br><span class="line"> </span><br><span class="line">  Tem.<span class="built_in">print</span>(DHT11.temperature); </span><br><span class="line">  Hum.<span class="built_in">print</span>(DHT11.humidity);  </span><br><span class="line">  Wind.<span class="built_in">print</span>(wind_value);           </span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">drawRect</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int16_t</span> i=<span class="number">0</span>; i&lt;oled.<span class="built_in">getHeight</span>()/<span class="number">2</span>; i+=<span class="number">2</span>) &#123;</span><br><span class="line">    oled.<span class="built_in">drawRect</span>(i, i, oled.<span class="built_in">getWidth</span>()<span class="number">-2</span>*i, oled.<span class="built_in">getHeight</span>()<span class="number">-2</span>*i);</span><br><span class="line">    oled.<span class="built_in">display</span>();</span><br><span class="line">    <span class="built_in">delay</span>(<span class="number">50</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pressuCheck</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">float</span> Pressure=<span class="number">0.0</span>;</span><br><span class="line"><span class="keyword">int</span> Pressure1,Pressure2,Pressure3,Pressure4,Pressure5,Pressure6,Pressure7,Pressure8;</span><br><span class="line">Pressure=bmp.<span class="built_in">readPressure</span>();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//由于气压的位数比较多，因此单独储存便于分类</span></span><br><span class="line">  Pressure1=(<span class="keyword">int</span>)Pressure/<span class="number">100000</span>;</span><br><span class="line">  Pressure2=(<span class="keyword">int</span>)Pressure/<span class="number">10000</span>%<span class="number">10</span>;</span><br><span class="line">  Pressure3=(<span class="keyword">int</span>)Pressure/<span class="number">1000</span>%<span class="number">10</span>;</span><br><span class="line">  Pressure4=(<span class="keyword">int</span>)Pressure/<span class="number">100</span>%<span class="number">10</span>;</span><br><span class="line">  Pressure5=(<span class="keyword">int</span>)Pressure/<span class="number">10</span>%<span class="number">10</span>;</span><br><span class="line">  Pressure6=(<span class="keyword">int</span>)Pressure%<span class="number">10</span>;</span><br><span class="line">  Pressure7=((<span class="keyword">int</span>)(Pressure*<span class="number">100</span>))/<span class="number">10</span>%<span class="number">10</span>;</span><br><span class="line">  Pressure8=((<span class="keyword">int</span>)(Pressure*<span class="number">100</span>))%<span class="number">10</span>;</span><br><span class="line">  oled.<span class="built_in">drawString</span>(<span class="number">4</span> + <span class="number">16</span>*<span class="number">2</span>, <span class="number">19</span>*<span class="number">2</span>, <span class="string">&quot;:&quot;</span>+number[Pressure1]+number[Pressure2]+number[Pressure3]+number[Pressure4]+number[Pressure5]+number[Pressure6]+<span class="string">&quot;.&quot;</span>+number[Pressure7]+number[Pressure8]+<span class="string">&quot;P&quot;</span>);</span><br><span class="line">    </span><br><span class="line">  Air.<span class="built_in">print</span>(Pressure);     </span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p><strong>注意事项：</strong></p><ul><li>代码中的中文汉字用到了一个叫  <img src="http://tva1.sinaimg.cn/large/008ruEzYly1gynsgushuej300l00lgld.jpg" alt="image.png"><code>PCtoLCD2002</code>  的软件,这个软件可以很方便的将汉字转化成对应的字形码来输出，这里用的是16*16的字宽字长。</li><li>在文章末尾的名叫<code>pressuCheck()</code>的子函数，之所以把这段单独写出来而不是写在<code>loop</code>函数里面去处理，不是因为笔者的代码习惯，而是必须这样不可。因为ESP8266芯片的内存有限，笔者一开始非常畅快的在<code>loop</code>函数中大写特写，结果虽然编译没有问题，但是上传到单片机上的时候，设备一直死机重启，害的笔者一开始还以为焊接的时候动到单片机的Rst引脚了，最后才反应过来是内存溢出的问题，把全局变量改为了局部变量之后，内存溢出问题得以解决。  </li><li>老生常谈，NodeMCU只支持3.3V电压，过高的电压可能会损坏芯片。</li><li>连接手机的app使用的是电灯科技的接口，一方面租用服务器很贵，对于这种学习性质的设计来说有些划不来，另一方面则是考虑到开发时间的问题，如果转向Android开发则会使得开发的重心偏移，关于Android我有计划在以后的博客中编写</li><li>最后，esp8266这块芯片真的很好用，使用Arduino的库真的省去了大量的重复造轮子的时间，如果转而用51<br>系列单片机开发代码量起码是这个的五倍。不过如果是用来学习嵌入式，我想51还是更好的选择，因为他更能让人深刻的理解嵌入开发。</li></ul><hr><h2 id="五、实物图"><a href="#五、实物图" class="headerlink" title="五、实物图"></a>五、实物图</h2><p><img src="http://tva1.sinaimg.cn/mw690/008ruEzYly1gynt3cnjfrj31hc0tu79g.jpg" alt="实物图1.jpg"><br><img src="http://tva1.sinaimg.cn/mw690/008ruEzYly1gynt3cnpaij31hc0tujxc.jpg" alt="实物图2.jpg"><br><img src="http://tva1.sinaimg.cn/mw690/008ruEzYly1gynt3colxaj31hc0tu0z5.jpg" alt="实物图3.jpg"></p><h2 id="六、结束"><a href="#六、结束" class="headerlink" title="六、结束"></a>六、结束</h2><p>这次的设计总的来说是数据的采集和发送，逻辑上并不困难，学习各个传感器的引脚定义可能花费了一点时间，但也并不属于很复杂的项目，今后有机会想做一些更有挑战性的东西。</p>]]></content>
    
    
    <summary type="html">经过一段时间对esp8266的了解和学习，尝试着做了一个esp8266的项目，是一个农业气象监测站，可以实时采集观测地的温湿度风速压强并显示在oled屏幕上，然后通过网络将数据传回用户手机APP，做到实时监测。</summary>
    
    
    
    <category term="设计开发" scheme="http://yoursite.com/categories/%E8%AE%BE%E8%AE%A1%E5%BC%80%E5%8F%91/"/>
    
    <category term="嵌入式" scheme="http://yoursite.com/categories/%E8%AE%BE%E8%AE%A1%E5%BC%80%E5%8F%91/%E5%B5%8C%E5%85%A5%E5%BC%8F/"/>
    
    
    <category term="嵌入式开发" scheme="http://yoursite.com/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/"/>
    
  </entry>
  
  <entry>
    <title>Esp8266与51单片机的Ap模式配置教程</title>
    <link href="http://yoursite.com/2022/01/18/AP_template/"/>
    <id>http://yoursite.com/2022/01/18/AP_template/</id>
    <published>2022-01-18T03:59:00.000Z</published>
    <updated>2023-11-01T17:53:32.151Z</updated>
    
    <content type="html"><![CDATA[<h2 id="一、什么是Esp8266的AP模式"><a href="#一、什么是Esp8266的AP模式" class="headerlink" title="一、什么是Esp8266的AP模式"></a>一、什么是Esp8266的AP模式</h2><p>ESP8266支持3种模式：<strong>Station模式、AP模式和Station+AP混合模式</strong>。关于这三种模式的区别可以类比我们的手机，当手机连接无线网时，此时手机为Station模式，当手机打开移动热点时，此时手机为AP模式。简单的说就是Station模式就是作为终端，AP模式就是作为路由器。而Station+AP混合模式，就和路由器的无线桥接功能是一样的，既可以连接别的无线网，同时也可以自己作为路由器。<br>本文是使用AP模式进行与手机的连接，从而控制单片机。  </p><hr><h2 id="二、ESP8266的准备工作"><a href="#二、ESP8266的准备工作" class="headerlink" title="二、ESP8266的准备工作"></a>二、ESP8266的准备工作</h2><p>在使用ESP8266之前需要进行一些配置，因为esp8266是一款功能丰富的芯片，通常我更喜欢直接针对它进行开发，在我看来，单单作为无线传输模块来使用未免有些“大材小用”之感，作为Ap模式来工作与蓝牙模块也并无大的不同，如果读者对esp8266的其他的模式感兴趣，比如mqtt协议之类的，可以查看我之前的帖子，那应该是更成熟的物联网方案。<br>闲话少叙，首先我们要将esp8266与电脑连接然后随便下载一个串口调试助手，对芯片进行一些配置。esp8266与电脑之间的通过usb-ttl方式的连线网上有很多，这里就不多做赘述，我个人推荐淘宝买个esp8266的专用下载器，会省事很多，不要把时间浪费在与芯片下载斗智斗勇上，应该多关注开发。<br>我使用的串口调试软件是<img src="https://pic.imgdb.cn/item/6267752b239250f7c58a6031.jpg" alt="XCOM"><code>XCOM</code>。下面贴调试命令：  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">AT+CWMODE=2    //这个命令是为了配置esp8266工作模式为AP模式</span><br><span class="line">返回值：OK</span><br><span class="line"></span><br><span class="line">AT+CWSAP=&quot;ESP8266&quot;,&quot;123456789&quot;,11,0  //这条命令是用来配置芯片热点的名称和密码以及加密方式</span><br><span class="line">返回值：OK</span><br><span class="line"></span><br><span class="line">AT+RST // 重启模块</span><br><span class="line"></span><br><span class="line">AT+UART=9600,8,1,0,0 //这条命令主要是设置波特率9600-波特率 8-8bit数据位 1-1bit停止位 0-none校验位 0-不使能流控。因为芯片波特率需要与单片机一致才能进行通信。</span><br><span class="line">返回值：OK</span><br><span class="line"></span><br><span class="line">AT+CIPMUX=1 //开启多连接，这句每次重启芯片都需要配置会写进代码里面</span><br><span class="line">返回值：OK</span><br><span class="line"></span><br><span class="line">AT+CIPSERVER=1,8080 //建立服务器，端口号8080，这句每次重启芯片都需要配置会写进代码里面</span><br><span class="line">返回值：OK</span><br></pre></td></tr></table></figure><p>通过串口助手依次输入以上命令之后，手机应该可以找到esp8266生成的一个wifi了，进行连接之后打开手机上的TCP网络调试助手，这个app网上有很多可以随便下一个，或者自己用androidstudio开发也并不会花很多时间，更重要的是自己开发你可以隐藏很多输入和命令，直接做成按钮事件，作为设计来说更为完善。<br>手机打开调试调试助手后，输入IP地址：192.168.4.1（通常默认为这个地址，可通过AT指令自查），端口号：8080（设置的数值）连接成功后随便发送一些消息给esp8266，比如hello，那么串口助手就会收到类似 +IPD,0,3:hello 这样的信息，这样我们芯片前期的配置工作就完成了。   </p><hr><h2 id="三、单片机方面"><a href="#三、单片机方面" class="headerlink" title="三、单片机方面"></a>三、单片机方面</h2><p>首先将单片机与ESP8266连接起来，连接方式也很简单和USB-TTL连接基本一致：<br>| 51单片机   | 3.3V | GND | TXD | RXD | 3.3V      |<br>|———|——|—–|—–|—–|———–|<br>| ESP8266 | VCC  | GND | RXD | TXD | EN(ch_pd) |</p><p>因为51单片机引脚电压为5V，esp8266工作电压确实3.3v因此直接连接可能会导致芯片寿命缩短甚至损坏，因此建议接一个电平转换模块来进行电平转换，再不济也需接个分压电阻。<br>模块连接好之后就可以向单片机中烧写程序了，代码贴在下面，建议自己敲一遍而不是直接复制粘贴，可以加深你对代码的理解：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;reg52.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> uchar unsigned char    <span class="comment">//对数据类型进行声明定义</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> uint unsigned int </span></span><br><span class="line"></span><br><span class="line">sbit LED1 = P2^<span class="number">0</span>;</span><br><span class="line">sbit LED2 = P2^<span class="number">1</span>;</span><br><span class="line">sbit LED3 = P2^<span class="number">2</span>;</span><br><span class="line">sbit LED4 = P2^<span class="number">3</span>;   <span class="comment">//用于调试的LED灯</span></span><br><span class="line">sbit LED5 = P2^<span class="number">4</span>;</span><br><span class="line">sbit LED6 = P2^<span class="number">5</span>;</span><br><span class="line">sbit LED7 = P2^<span class="number">6</span>;</span><br><span class="line">sbit LED8 = P2^<span class="number">7</span>;   <span class="comment">//手机可以控制的LED灯</span></span><br><span class="line"></span><br><span class="line">uchar TX_Flag = <span class="number">1</span>;   <span class="comment">//发送状态标志位，1允许发送，0发送结束</span></span><br><span class="line">uchar RX_Flag = <span class="number">1</span>;   <span class="comment">//接收状态标志位，1允许接收，0接收结束</span></span><br><span class="line">uchar num=<span class="number">0</span>;   <span class="comment">//接收超时判断</span></span><br><span class="line">uchar Recivedata;   <span class="comment">//存储接收到的一个字节数据</span></span><br><span class="line"></span><br><span class="line">uchar Recive_table[<span class="number">15</span>];</span><br><span class="line">uint i=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ms_delay</span><span class="params">(uint n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">uint j,m;</span><br><span class="line"><span class="keyword">for</span>( m =n; m&gt;<span class="number">0</span>; m--)</span><br><span class="line"><span class="keyword">for</span>(j=<span class="number">110</span>; j&gt;<span class="number">0</span>; j--);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">us_delay</span><span class="params">(uchar n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">while</span>(n--);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/******************************************************************</span></span><br><span class="line"><span class="comment">函 数: void Usart_init()</span></span><br><span class="line"><span class="comment">功 能: 单片机初始化</span></span><br><span class="line"><span class="comment">参 数: 无</span></span><br><span class="line"><span class="comment">返回值: 无</span></span><br><span class="line"><span class="comment">*******************************************************************/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Usart_init</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">SCON = <span class="number">0x50</span>;<span class="comment">//设置串行口工作在方式一，且启动串行口接收(REN=1)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">TMOD = <span class="number">0x20</span>;<span class="comment">//定时器1工作在方式2八位自动重装模式</span></span><br><span class="line">TH1 = <span class="number">0xfd</span>;</span><br><span class="line">TL1 = <span class="number">0xfd</span>;</span><br><span class="line">TR1 = <span class="number">1</span>;<span class="comment">//开启定时器1</span></span><br><span class="line"></span><br><span class="line">PCON = <span class="number">0x00</span>;<span class="comment">//波特率不加倍</span></span><br><span class="line">SM0 = <span class="number">0</span>;<span class="comment">//串口工作方式</span></span><br><span class="line">SM1 = <span class="number">1</span>;</span><br><span class="line">REN = <span class="number">1</span>;<span class="comment">//串口接收允许</span></span><br><span class="line">EA = <span class="number">1</span>;<span class="comment">//打开全局中断</span></span><br><span class="line">ES = <span class="number">1</span>;<span class="comment">//允许串口中断</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/******************************************************************</span></span><br><span class="line"><span class="comment">函 数: void Sent_AT(uchar *At_Comd)</span></span><br><span class="line"><span class="comment">功 能: AT指令发送</span></span><br><span class="line"><span class="comment">参 数: 字符串指针</span></span><br><span class="line"><span class="comment">返回值: 无</span></span><br><span class="line"><span class="comment">*******************************************************************/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Sent_AT</span><span class="params">(uchar *At_Comd)</span>  <span class="comment">//定义字符串指针指向AT指令</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">ES = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>(*At_Comd != <span class="string">&#x27;\0&#x27;</span>)   <span class="comment">//字符串结束标志</span></span><br><span class="line">&#123;</span><br><span class="line">SBUF = *At_Comd;  <span class="comment">//写入1个字节数据</span></span><br><span class="line"><span class="keyword">while</span>(!TI);  <span class="comment">//等待该字节数据发送完成</span></span><br><span class="line">TI = <span class="number">0</span>;  <span class="comment">//发送标志位清零</span></span><br><span class="line"><span class="built_in">us_delay</span>(<span class="number">5</span>);</span><br><span class="line">At_Comd++;  <span class="comment">//指向下一个字节</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/******************************************************************</span></span><br><span class="line"><span class="comment">函 数: void WIFI_Init(void)</span></span><br><span class="line"><span class="comment">功 能: wifi初始化</span></span><br><span class="line"><span class="comment">参 数: 无</span></span><br><span class="line"><span class="comment">返回值: 无</span></span><br><span class="line"><span class="comment">*******************************************************************/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">WIFI_Init</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">        ES = <span class="number">0</span>;                                <span class="comment">//关闭串口中断，防止收发过程被打扰</span></span><br><span class="line"><span class="keyword">while</span>(TX_Flag == <span class="number">1</span>)&#123;</span><br><span class="line"><span class="built_in">Sent_AT</span>(<span class="string">&quot;AT+CIPMUX=1\r\n&quot;</span>);        <span class="comment">//调用发送函数</span></span><br><span class="line">  LED1=<span class="number">0</span>;   <span class="comment">//表示发送正常</span></span><br><span class="line"><span class="keyword">while</span>(RX_Flag == <span class="number">1</span>)            <span class="comment">//检测模块是否返回OK</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(RI)</span><br><span class="line">&#123;</span><br><span class="line">RI = <span class="number">0</span>;</span><br><span class="line">Recivedata = SBUF;   <span class="comment">//保存当前接收到的1个字</span></span><br><span class="line"><span class="keyword">if</span>(Recivedata == <span class="string">&#x27;K&#x27;</span>)  <span class="comment">//回传“OK”中的K表示配置完成</span></span><br><span class="line">&#123;</span><br><span class="line">TX_Flag = <span class="number">0</span>;   <span class="comment">//标志位清零，跳出收发循环</span></span><br><span class="line">RX_Flag = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">num++;   <span class="comment">//累加</span></span><br><span class="line"><span class="keyword">if</span>(num == <span class="number">1000</span>)   <span class="comment">//未收到OK或接收超时</span></span><br><span class="line">&#123;</span><br><span class="line">num = <span class="number">0</span>;</span><br><span class="line">RX_Flag = <span class="number">0</span>;   <span class="comment">//跳出接收查询，再次发送</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">TX_Flag = <span class="number">1</span>;   <span class="comment">//跳出循环，表示配置成功</span></span><br><span class="line">RX_Flag = <span class="number">1</span>;</span><br><span class="line">num = <span class="number">0</span>;   <span class="comment">//标志位还原</span></span><br><span class="line">        LED2 = <span class="number">0</span>;   <span class="comment">//可通过LED灯表示配置完成</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(TX_Flag == <span class="number">1</span>)&#123;</span><br><span class="line"><span class="built_in">Sent_AT</span>(<span class="string">&quot;AT+CIPSERVER=1,8080\r\n&quot;</span>);</span><br><span class="line">    LED3=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>(RX_Flag == <span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(RI)</span><br><span class="line">&#123;</span><br><span class="line">RI = <span class="number">0</span>;</span><br><span class="line">Recivedata = SBUF;</span><br><span class="line"><span class="keyword">if</span>(Recivedata == <span class="string">&#x27;K&#x27;</span>)</span><br><span class="line">&#123;</span><br><span class="line">TX_Flag= <span class="number">0</span>;</span><br><span class="line">RX_Flag = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">num++;</span><br><span class="line"><span class="keyword">if</span>(num == <span class="number">1000</span>)</span><br><span class="line">&#123;</span><br><span class="line">num = <span class="number">0</span>;</span><br><span class="line">RX_Flag = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">TX_Flag= <span class="number">1</span>;</span><br><span class="line">RX_Flag = <span class="number">1</span>;</span><br><span class="line">num = <span class="number">0</span>;</span><br><span class="line">LED4 = <span class="number">0</span>;</span><br><span class="line">ES=<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**********************主函数************************/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">Usart_init</span>();</span><br><span class="line"><span class="built_in">ms_delay</span>(<span class="number">5000</span>);</span><br><span class="line"><span class="built_in">WIFI_Init</span>();</span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>);<span class="comment">///循环等待中断</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************************************</span></span><br><span class="line"><span class="comment">函 数: void Uart_Interrupt() interrupt 4</span></span><br><span class="line"><span class="comment">功 能: 串口中断函数,将收到的字符存到Recive_table[]数组中</span></span><br><span class="line"><span class="comment">参 数: 无</span></span><br><span class="line"><span class="comment">返回值: 无</span></span><br><span class="line"><span class="comment">*******************************************************************/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Uart_Interrupt</span><span class="params">()</span> interrupt 4                <span class="comment">//中断服务程序接收并处理数据</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(RI==<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">RI=<span class="number">0</span>;   <span class="comment">//接收标志位清零</span></span><br><span class="line">Recive_table[i] = SBUF;   <span class="comment">//将数据存入数组</span></span><br><span class="line"><span class="keyword">if</span>(Recive_table[<span class="number">0</span>]==<span class="string">&#x27;+&#x27;</span>)   <span class="comment">//初步检测有用信息</span></span><br><span class="line">&#123;i++;&#125;      </span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;i=<span class="number">0</span>;&#125;</span><br><span class="line"><span class="keyword">if</span>(i&gt;=<span class="number">10</span>)     <span class="comment">//一组数据接收完成</span></span><br><span class="line">&#123;</span><br><span class="line">LED5 = <span class="number">0</span>;   <span class="comment">//LED显示接收完成</span></span><br><span class="line"><span class="keyword">if</span>((Recive_table[<span class="number">0</span>]==<span class="string">&#x27;+&#x27;</span>)&amp;&amp;(Recive_table[<span class="number">1</span>]==<span class="string">&#x27;I&#x27;</span>)&amp;&amp;(Recive_table[<span class="number">2</span>]==<span class="string">&#x27;P&#x27;</span>)&amp;&amp;(Recive_table[<span class="number">3</span>]==<span class="string">&#x27;D&#x27;</span>))</span><br><span class="line">&#123; <span class="comment">//检测有效信息</span></span><br><span class="line"><span class="keyword">if</span>((Recive_table[<span class="number">9</span>]==<span class="string">&#x27;0&#x27;</span>))</span><br><span class="line">&#123;</span><br><span class="line">LED8=<span class="number">0</span>;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>((Recive_table[<span class="number">9</span>]==<span class="string">&#x27;1&#x27;</span>))</span><br><span class="line">&#123;</span><br><span class="line">LED8=<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">LED7=<span class="number">0</span>; <span class="comment">//发送信息不符合</span></span><br><span class="line">i = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"> LED6=<span class="number">0</span>; <span class="comment">//未接收到正确格式数据</span></span><br><span class="line">i = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> TI = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>一个常识性的问题——烧写程序的时候TXD和RXD引脚需置空否则会烧写失败，程序烧进单片机之后，按一下板子的复位按钮，如果看到ESP模块上面蓝色小灯闪了，证明开发板跟ESP-01模块通信正常。然后用手机连上WIFI，打开TCP助手，建立一个新连接，IP地址192.168.4.1，端口8080，如果发送一个1，开发板上的小灯亮了，发送0，灯灭了（可能根据led共阴接法和共阳接法不同而有所改变），说明一切正常，如果不是这样的话，那就需要自己找找原因了，比如led口的接口定义与代码中是否一致。</p><hr><h2 id="结束"><a href="#结束" class="headerlink" title="结束"></a>结束</h2><p>我用开发板进行的一个简单的程序验证和测试，只是一个模板代码，具体需要实现什么功能就请自己修改吧。</p>]]></content>
    
    
    <summary type="html">这是一个学弟问esp8266与51单片机连接然后通过手机来对单片机进行操作的配置问题，感觉发消息不方便贴代码和讲解，就干脆小写一篇教程了。</summary>
    
    
    
    <category term="学习记录" scheme="http://yoursite.com/categories/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"/>
    
    <category term="模板记录" scheme="http://yoursite.com/categories/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/%E6%A8%A1%E6%9D%BF%E8%AE%B0%E5%BD%95/"/>
    
    
    <category term="学习" scheme="http://yoursite.com/tags/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="记录" scheme="http://yoursite.com/tags/%E8%AE%B0%E5%BD%95/"/>
    
  </entry>
  
  <entry>
    <title>Esp8266与51单片机的Ap模式发送数据模板</title>
    <link href="http://yoursite.com/2022/01/16/AP_sendMessage/"/>
    <id>http://yoursite.com/2022/01/16/AP_sendMessage/</id>
    <published>2022-01-16T09:58:04.000Z</published>
    <updated>2023-11-01T17:54:00.423Z</updated>
    
    <content type="html"><![CDATA[<h2 id="准备与连接"><a href="#准备与连接" class="headerlink" title="准备与连接"></a>准备与连接</h2><p>51单片机与esp8266芯片的配置与连线请参考上一篇博客进行配置，配置完成并连线即可。</p><hr><h2 id="发送代码"><a href="#发送代码" class="headerlink" title="发送代码"></a>发送代码</h2><p>将以下代码烧录进单片机中</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;reg52.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;intrins.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> u16;  <span class="comment">//对数据类型进行声明定义</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> u8;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MotorData P0 </span></span><br><span class="line">sbit P20_LED=P2^<span class="number">0</span>;<span class="comment">//led灯</span></span><br><span class="line">sbit LED1=P2^<span class="number">1</span>;<span class="comment">//led1</span></span><br><span class="line">sbit LED2=P2^<span class="number">2</span>;<span class="comment">//led2</span></span><br><span class="line">sbit LED3=P2^<span class="number">3</span>;<span class="comment">//led3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> rec_dat[<span class="number">4</span>]=&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>&#125;;         <span class="comment">//存放要发送的数据</span></span><br><span class="line"><span class="keyword">char</span> Recive_table[<span class="number">20</span>]=<span class="string">&quot;&quot;</span>;  <span class="comment">//接收缓冲,最大20个字节</span></span><br><span class="line"><span class="keyword">char</span> Recive_state = <span class="number">0</span>;   <span class="comment">//接收完成标志</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">WIFI_Init</span><span class="params">(<span class="keyword">void</span>)</span></span>;    <span class="comment">//wifi初始化</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sending</span><span class="params">(<span class="keyword">void</span>)</span></span>;   <span class="comment">//向手机发送温湿度数据</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Uart_Init</span><span class="params">(<span class="keyword">void</span>)</span></span>;    <span class="comment">//串口初始化</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ms_delay</span><span class="params">(<span class="keyword">int</span> t)</span></span>;    <span class="comment">//延时</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LED</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line">u8 flag;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">Uart_Init</span>();<span class="comment">//串口初始化，波特率为9600</span></span><br><span class="line"><span class="built_in">ms_delay</span>(<span class="number">1000</span>) ;</span><br><span class="line"><span class="built_in">WIFI_Init</span>(); <span class="comment">//wifi初始化</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**********************主循环************************/</span></span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">&#123; </span><br><span class="line">  <span class="comment">//ms_delay(1000);</span></span><br><span class="line"><span class="keyword">if</span>(Recive_state == <span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">ES=<span class="number">0</span>;  <span class="comment">//清空接收标志位 </span></span><br><span class="line"><span class="keyword">if</span>((Recive_table[<span class="number">0</span>]==<span class="string">&#x27;+&#x27;</span>)&amp;&amp;(Recive_table[<span class="number">1</span>]==<span class="string">&#x27;I&#x27;</span>)&amp;&amp;(Recive_table[<span class="number">2</span>]==<span class="string">&#x27;P&#x27;</span>))<span class="comment">//接收到的字符串形式为+IPD,x,x:y</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>((Recive_table[<span class="number">3</span>]==<span class="string">&#x27;D&#x27;</span>)&amp;&amp;(Recive_table[<span class="number">6</span>]==<span class="string">&#x27;,&#x27;</span>))</span><br><span class="line">    &#123;   </span><br><span class="line">        <span class="keyword">if</span>(Recive_table[<span class="number">9</span>]==<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">&#123;</span><br><span class="line">P20_LED = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">ms_delay</span>(<span class="number">1000</span>);</span><br><span class="line">P20_LED = <span class="number">1</span>;</span><br><span class="line"><span class="built_in">sending</span>(); <span class="comment">//向手机发送数据</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(Recive_table[<span class="number">9</span>]==<span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">&#123;</span><br><span class="line">P20_LED = <span class="number">1</span>;</span><br><span class="line"><span class="built_in">ms_delay</span>(<span class="number">1000</span>) ;</span><br><span class="line">P20_LED = <span class="number">0</span>;</span><br><span class="line">flag=<span class="number">0</span>; <span class="comment">//自动</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">memset</span>(Recive_table,<span class="string">&#x27;\0&#x27;</span>,<span class="number">20</span>);</span><br><span class="line">Recive_state = <span class="number">0</span>;</span><br><span class="line">ES=<span class="number">1</span>;  <span class="comment">//打开接收标志位</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/******************************************************************</span></span><br><span class="line"><span class="comment">函 数: void Uart_Interrupt() interrupt 4</span></span><br><span class="line"><span class="comment">功 能: 串口中断函数,将收到的字符存到Recive_table[]数组中</span></span><br><span class="line"><span class="comment">参 数: 无</span></span><br><span class="line"><span class="comment">返回值: 无</span></span><br><span class="line"><span class="comment">*******************************************************************/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Uart_Interrupt</span><span class="params">()</span> interrupt 4         </span></span><br><span class="line"><span class="function"></span>&#123;   </span><br><span class="line"><span class="keyword">static</span> <span class="keyword">char</span> i=<span class="number">0</span>;  <span class="comment">//因为是一位一位接收，所以用static</span></span><br><span class="line"><span class="keyword">if</span>(RI==<span class="number">1</span>)    </span><br><span class="line">&#123;  </span><br><span class="line">ES = <span class="number">0</span>;</span><br><span class="line">RI=<span class="number">0</span>;         </span><br><span class="line">Recive_table[i]=SBUF;        </span><br><span class="line">i++; </span><br><span class="line"><span class="keyword">if</span>((Recive_table[i<span class="number">-1</span>] == <span class="string">&#x27;\n&#x27;</span>))</span><br><span class="line">&#123; </span><br><span class="line">Recive_table[i]=<span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">i=<span class="number">0</span>; </span><br><span class="line">Recive_state = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">ES = <span class="number">1</span>;      </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">TI = <span class="number">0</span>;     </span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line"><span class="comment">/******************************************************************</span></span><br><span class="line"><span class="comment">函 数: void Uart_Init(void)</span></span><br><span class="line"><span class="comment">功 能: 串口初始化，波特率为9600</span></span><br><span class="line"><span class="comment">参 数: 无</span></span><br><span class="line"><span class="comment">返回值: 无</span></span><br><span class="line"><span class="comment">*******************************************************************/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Uart_Init</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">TMOD=<span class="number">0x20</span>;</span><br><span class="line">TH1=<span class="number">0xfD</span>;</span><br><span class="line">TL1=<span class="number">0xfD</span>;</span><br><span class="line">TR1=<span class="number">1</span>;</span><br><span class="line">REN=<span class="number">1</span>;</span><br><span class="line">SM0=<span class="number">0</span>;</span><br><span class="line">SM1=<span class="number">1</span>;</span><br><span class="line">EA=<span class="number">1</span>;</span><br><span class="line">ES=<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/******************************************************************</span></span><br><span class="line"><span class="comment">函 数: void ms_delay(int t)</span></span><br><span class="line"><span class="comment">功 能: 毫秒级延时</span></span><br><span class="line"><span class="comment">参 数: 无</span></span><br><span class="line"><span class="comment">返回值: 无</span></span><br><span class="line"><span class="comment">*******************************************************************/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ms_delay</span><span class="params">(<span class="keyword">int</span> t)</span> </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line"><span class="keyword">int</span> i,j; </span><br><span class="line"><span class="keyword">for</span>(i=t;i&gt;<span class="number">0</span>;i--)   </span><br><span class="line"><span class="keyword">for</span>(j=<span class="number">110</span>;j&gt;<span class="number">0</span>;j--); </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/******************************************************************</span></span><br><span class="line"><span class="comment">函 数: void LED(void)</span></span><br><span class="line"><span class="comment">功 能: 发送完命令后显示用的函数</span></span><br><span class="line"><span class="comment">参 数: 无</span></span><br><span class="line"><span class="comment">返回值: 无</span></span><br><span class="line"><span class="comment">*******************************************************************/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LED</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">P2 = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">ms_delay</span>(<span class="number">100</span>);</span><br><span class="line">P2 = <span class="number">0xff</span>;</span><br><span class="line"><span class="built_in">ms_delay</span>(<span class="number">100</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/******************************************************************</span></span><br><span class="line"><span class="comment">函 数: void WIFI_Init(void)</span></span><br><span class="line"><span class="comment">功 能: wifi初始化</span></span><br><span class="line"><span class="comment">参 数: 无</span></span><br><span class="line"><span class="comment">返回值: 无</span></span><br><span class="line"><span class="comment">*******************************************************************/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">WIFI_Init</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">ES = <span class="number">0</span>;</span><br><span class="line">TI = <span class="number">1</span>; </span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;AT+RST\r\n&quot;</span>);</span><br><span class="line"><span class="built_in">LED</span>();</span><br><span class="line"><span class="built_in">ms_delay</span>(<span class="number">1000</span>) ;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;AT+CWMODE=3\r\n&quot;</span>);</span><br><span class="line"><span class="built_in">LED</span>();</span><br><span class="line"><span class="built_in">ms_delay</span>(<span class="number">1000</span>) ;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;AT+CIPMUX=1\r\n&quot;</span>);</span><br><span class="line"><span class="built_in">LED</span>(); </span><br><span class="line"><span class="built_in">ms_delay</span>(<span class="number">1000</span>) ;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;AT+CIPSERVER=1,8080\r\n&quot;</span>);        </span><br><span class="line"><span class="built_in">LED</span>();</span><br><span class="line"><span class="built_in">ms_delay</span>(<span class="number">1000</span>) ;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;AT+CIOBAUD=9600\r\n&quot;</span>);   <span class="comment">// 设置与单片机一致的波特率     </span></span><br><span class="line"><span class="built_in">LED</span>();</span><br><span class="line"><span class="built_in">ms_delay</span>(<span class="number">1000</span>);</span><br><span class="line"><span class="keyword">while</span>(!TI);</span><br><span class="line">TI = <span class="number">0</span>;</span><br><span class="line">ES = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//向手机发送数据</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sending</span><span class="params">(<span class="keyword">void</span>)</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">ES = <span class="number">0</span>;</span><br><span class="line">TI = <span class="number">1</span>; </span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;AT+CIPSTART=0,\&quot;TCP\&quot;,\&quot;192.168.4.2\&quot;,8080\r\n&quot;</span>);</span><br><span class="line"><span class="built_in">ms_delay</span>(<span class="number">1000</span>) ;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;AT+CIPSEND=0,11\r\n&quot;</span>);</span><br><span class="line"><span class="built_in">ms_delay</span>(<span class="number">1000</span>) ;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;Humi:%d.%d \r\n&quot;</span>,rec_dat[<span class="number">1</span>],rec_dat[<span class="number">3</span>]);</span><br><span class="line"><span class="built_in">ms_delay</span>(<span class="number">1000</span>) ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(!TI);</span><br><span class="line">TI = <span class="number">0</span>;</span><br><span class="line">ES = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong><code>rec_dat[i]</code>中保存的是需要发送的数据。</strong>  </p><hr><h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><p>用手机连上WIFI，打开TCP助手，建立一个新连接，IP地址192.168.4.1，端口8080，如果发送一个1，TCP助手软件接收到一个发送过来设定的数值，那么连接建立成功，发送数据成立。</p>]]></content>
    
    
    <summary type="html">之前写了一篇博客用来描述esp8266与51单片机如何进行连线和一些芯片的配置以及代码模板，但是并没有涉及到发送数据，这篇教程就用来放一篇51系列单片机透过esp8266向手机发送消息的模板。</summary>
    
    
    
    <category term="学习记录" scheme="http://yoursite.com/categories/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"/>
    
    <category term="模板记录" scheme="http://yoursite.com/categories/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/%E6%A8%A1%E6%9D%BF%E8%AE%B0%E5%BD%95/"/>
    
    
    <category term="学习" scheme="http://yoursite.com/tags/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="记录" scheme="http://yoursite.com/tags/%E8%AE%B0%E5%BD%95/"/>
    
  </entry>
  
  <entry>
    <title>基于Arduino的智能避障小车的设计</title>
    <link href="http://yoursite.com/2022/01/14/BiZhangChe/"/>
    <id>http://yoursite.com/2022/01/14/BiZhangChe/</id>
    <published>2022-01-13T16:00:09.000Z</published>
    <updated>2023-11-01T17:31:42.817Z</updated>
    
    <content type="html"><![CDATA[<h2 id="一、原件清单"><a href="#一、原件清单" class="headerlink" title="一、原件清单"></a>一、原件清单</h2><ul><li>Arduino Uno开发板</li><li>L293D </li><li>轮子 (4x)</li><li>直流电机 (4x) </li><li>伺服电机sg90 </li><li>超声波传感器 </li><li>18650 锂电池 (2x) </li><li>18650 插针式电池盒子</li><li>跳线</li><li>亚克力板</li><li>三脚拨动开关   </li></ul><hr><h2 id="二、硬件连接"><a href="#二、硬件连接" class="headerlink" title="二、硬件连接"></a>二、硬件连接</h2><ol><li><p>L293D直流电机驱动模块与Arduino兼容，模块的0~13、gnd、以及ARef引脚直接连接对应Arduino的引脚，另一侧同样对应连接。  </p></li><li><p>图中标记为L293D的四个H桥，可分别连接四个直流电机。<br><img src="http://tva1.sinaimg.cn/mw690/008ruEzYly1gycixlm8n3j30ep0gfdog.jpg" alt="L293D">  </p></li><li><p>超声波传感器的Vcc连接L293D的+5v，Gnd连接L293D的Gnd，Trig连A0，Echo连接A1。  </p></li><li><p>伺服电机直接连接L293D板子的伺服电机端口。   </p></li><li><p>两节18650锂电池串联接入L293D的外部供电。  </p></li></ol><h2 id="三、程序代码"><a href="#三、程序代码" class="headerlink" title="三、程序代码"></a>三、程序代码</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;AFMotor.h&gt;</span>  </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;NewPing.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Servo.h&gt;</span> </span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> TRIG_PIN A0 </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ECHO_PIN A1 </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_DISTANCE 200 </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_SPEED 190 <span class="comment">// sets speed of DC  motors</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_SPEED_OFFSET 20</span></span><br><span class="line"></span><br><span class="line"><span class="function">NewPing <span class="title">sonar</span><span class="params">(TRIG_PIN, ECHO_PIN, MAX_DISTANCE)</span></span>; </span><br><span class="line"></span><br><span class="line"><span class="function">AF_DCMotor <span class="title">motor1</span><span class="params">(<span class="number">1</span>, MOTOR12_1KHZ)</span></span>; </span><br><span class="line"><span class="function">AF_DCMotor <span class="title">motor2</span><span class="params">(<span class="number">2</span>, MOTOR12_1KHZ)</span></span>;</span><br><span class="line"><span class="function">AF_DCMotor <span class="title">motor3</span><span class="params">(<span class="number">3</span>, MOTOR34_1KHZ)</span></span>;</span><br><span class="line"><span class="function">AF_DCMotor <span class="title">motor4</span><span class="params">(<span class="number">4</span>, MOTOR34_1KHZ)</span></span>;</span><br><span class="line">Servo myservo;   </span><br><span class="line"></span><br><span class="line">boolean goesForward=<span class="literal">false</span>;</span><br><span class="line"><span class="keyword">int</span> distance = <span class="number">100</span>;</span><br><span class="line"><span class="keyword">int</span> speedSet = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  myservo.<span class="built_in">attach</span>(<span class="number">10</span>);  </span><br><span class="line">  myservo.<span class="built_in">write</span>(<span class="number">180</span>); </span><br><span class="line">  <span class="built_in">delay</span>(<span class="number">2000</span>);</span><br><span class="line">  distance = <span class="built_in">readPing</span>();</span><br><span class="line">  <span class="built_in">delay</span>(<span class="number">100</span>);</span><br><span class="line">  distance = <span class="built_in">readPing</span>();</span><br><span class="line">  <span class="built_in">delay</span>(<span class="number">100</span>);</span><br><span class="line">  distance = <span class="built_in">readPing</span>();</span><br><span class="line">  <span class="built_in">delay</span>(<span class="number">100</span>);</span><br><span class="line">  distance = <span class="built_in">readPing</span>();</span><br><span class="line">  <span class="built_in">delay</span>(<span class="number">100</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">loop</span><span class="params">()</span> </span>&#123;</span><br><span class="line"> <span class="keyword">int</span> distanceR = <span class="number">0</span>;</span><br><span class="line"> <span class="keyword">int</span> distanceL =  <span class="number">0</span>;</span><br><span class="line"> <span class="built_in">delay</span>(<span class="number">40</span>);</span><br><span class="line"> </span><br><span class="line"> <span class="keyword">if</span>(distance&lt;=<span class="number">15</span>)</span><br><span class="line"> &#123;</span><br><span class="line">  <span class="built_in">moveStop</span>();</span><br><span class="line">  <span class="built_in">delay</span>(<span class="number">100</span>);</span><br><span class="line">  <span class="built_in">moveBackward</span>();</span><br><span class="line">  <span class="built_in">delay</span>(<span class="number">300</span>);</span><br><span class="line">  <span class="built_in">moveStop</span>();</span><br><span class="line">  <span class="built_in">delay</span>(<span class="number">200</span>);</span><br><span class="line">  distanceR = <span class="built_in">lookRight</span>();</span><br><span class="line">  <span class="built_in">delay</span>(<span class="number">200</span>);</span><br><span class="line">  distanceL = <span class="built_in">lookLeft</span>();</span><br><span class="line">  <span class="built_in">delay</span>(<span class="number">200</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(distanceR&gt;=distanceL)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">turnRight</span>();</span><br><span class="line">    <span class="built_in">moveStop</span>();</span><br><span class="line">  &#125;<span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">turnLeft</span>();</span><br><span class="line">    <span class="built_in">moveStop</span>();</span><br><span class="line">  &#125;</span><br><span class="line"> &#125;<span class="keyword">else</span></span><br><span class="line"> &#123;</span><br><span class="line">  <span class="built_in">moveForward</span>();</span><br><span class="line"> &#125;</span><br><span class="line"> distance = <span class="built_in">readPing</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">lookRight</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    myservo.<span class="built_in">write</span>(<span class="number">50</span>); </span><br><span class="line">    <span class="built_in">delay</span>(<span class="number">500</span>);</span><br><span class="line">    <span class="keyword">int</span> distance = <span class="built_in">readPing</span>();</span><br><span class="line">    <span class="built_in">delay</span>(<span class="number">100</span>);</span><br><span class="line">    myservo.<span class="built_in">write</span>(<span class="number">115</span>); </span><br><span class="line">    <span class="keyword">return</span> distance;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">lookLeft</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    myservo.<span class="built_in">write</span>(<span class="number">170</span>); </span><br><span class="line">    <span class="built_in">delay</span>(<span class="number">500</span>);</span><br><span class="line">    <span class="keyword">int</span> distance = <span class="built_in">readPing</span>();</span><br><span class="line">    <span class="built_in">delay</span>(<span class="number">100</span>);</span><br><span class="line">    myservo.<span class="built_in">write</span>(<span class="number">115</span>); </span><br><span class="line">    <span class="keyword">return</span> distance;</span><br><span class="line">    <span class="built_in">delay</span>(<span class="number">100</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">readPing</span><span class="params">()</span> </span>&#123; </span><br><span class="line">  <span class="built_in">delay</span>(<span class="number">70</span>);</span><br><span class="line">  <span class="keyword">int</span> cm = sonar.<span class="built_in">ping_cm</span>();</span><br><span class="line">  <span class="keyword">if</span>(cm==<span class="number">0</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    cm = <span class="number">250</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> cm;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">moveStop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  motor1.<span class="built_in">run</span>(RELEASE); </span><br><span class="line">  motor2.<span class="built_in">run</span>(RELEASE);</span><br><span class="line">  motor3.<span class="built_in">run</span>(RELEASE);</span><br><span class="line">  motor4.<span class="built_in">run</span>(RELEASE);</span><br><span class="line">  &#125; </span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">moveForward</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">if</span>(!goesForward)</span><br><span class="line">  &#123;</span><br><span class="line">    goesForward=<span class="literal">true</span>;</span><br><span class="line">    motor1.<span class="built_in">run</span>(FORWARD);      </span><br><span class="line">    motor2.<span class="built_in">run</span>(FORWARD);</span><br><span class="line">    motor3.<span class="built_in">run</span>(FORWARD); </span><br><span class="line">    motor4.<span class="built_in">run</span>(FORWARD);     </span><br><span class="line">   <span class="keyword">for</span> (speedSet = <span class="number">0</span>; speedSet &lt; MAX_SPEED; speedSet +=<span class="number">2</span>) <span class="comment">// slowly bring the speed up to avoid loading down the batteries too quickly</span></span><br><span class="line">   &#123;</span><br><span class="line">    motor1.<span class="built_in">setSpeed</span>(speedSet);</span><br><span class="line">    motor2.<span class="built_in">setSpeed</span>(speedSet);</span><br><span class="line">    motor3.<span class="built_in">setSpeed</span>(speedSet);</span><br><span class="line">    motor4.<span class="built_in">setSpeed</span>(speedSet);</span><br><span class="line">    <span class="built_in">delay</span>(<span class="number">5</span>);</span><br><span class="line">   &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">moveBackward</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    goesForward=<span class="literal">false</span>;</span><br><span class="line">    motor1.<span class="built_in">run</span>(BACKWARD);      </span><br><span class="line">    motor2.<span class="built_in">run</span>(BACKWARD);</span><br><span class="line">    motor3.<span class="built_in">run</span>(BACKWARD);</span><br><span class="line">    motor4.<span class="built_in">run</span>(BACKWARD);  </span><br><span class="line">  <span class="keyword">for</span> (speedSet = <span class="number">0</span>; speedSet &lt; MAX_SPEED; speedSet +=<span class="number">2</span>) <span class="comment">// slowly bring the speed up to avoid loading down the batteries too quickly</span></span><br><span class="line">  &#123;</span><br><span class="line">    motor1.<span class="built_in">setSpeed</span>(speedSet);</span><br><span class="line">    motor2.<span class="built_in">setSpeed</span>(speedSet);</span><br><span class="line">    motor3.<span class="built_in">setSpeed</span>(speedSet);</span><br><span class="line">    motor4.<span class="built_in">setSpeed</span>(speedSet);</span><br><span class="line">    <span class="built_in">delay</span>(<span class="number">5</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">turnRight</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  motor1.<span class="built_in">run</span>(FORWARD);</span><br><span class="line">  motor2.<span class="built_in">run</span>(FORWARD);</span><br><span class="line">  motor3.<span class="built_in">run</span>(BACKWARD);</span><br><span class="line">  motor4.<span class="built_in">run</span>(BACKWARD);     </span><br><span class="line">  <span class="built_in">delay</span>(<span class="number">500</span>);</span><br><span class="line">  motor1.<span class="built_in">run</span>(FORWARD);      </span><br><span class="line">  motor2.<span class="built_in">run</span>(FORWARD);</span><br><span class="line">  motor3.<span class="built_in">run</span>(FORWARD);</span><br><span class="line">  motor4.<span class="built_in">run</span>(FORWARD);      </span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">turnLeft</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  motor1.<span class="built_in">run</span>(BACKWARD);     </span><br><span class="line">  motor2.<span class="built_in">run</span>(BACKWARD);  </span><br><span class="line">  motor3.<span class="built_in">run</span>(FORWARD);</span><br><span class="line">  motor4.<span class="built_in">run</span>(FORWARD);   </span><br><span class="line">  <span class="built_in">delay</span>(<span class="number">500</span>);</span><br><span class="line">  motor1.<span class="built_in">run</span>(FORWARD);     </span><br><span class="line">  motor2.<span class="built_in">run</span>(FORWARD);</span><br><span class="line">  motor3.<span class="built_in">run</span>(FORWARD);</span><br><span class="line">  motor4.<span class="built_in">run</span>(FORWARD);</span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure><h2 id="四、注意事项"><a href="#四、注意事项" class="headerlink" title="四、注意事项"></a>四、注意事项</h2><p><strong>1. 使用18650作外部供电时，切记不要连反了线，否则会有烧芯片的风险。</strong><br><strong>2. 伺服电机应该选择限制旋转180°的sg90，而不能选择mg90一类的360舵机，原因是后者只能调正反转和速度，而不能像前者一样旋转固定的角度。</strong><br><strong>3. Arduino程序烧录时，有三个必要的支持库需要下载，下面是下载链接以及安装方式。</strong>  </p><blockquote><p>AFMotor Library <a href="https://learn.adafruit.com/adafruit-motor-shield/library-install">https://learn.adafruit.com/adafruit-motor-shield/library-install</a><br>NewPing Library <a href="https://github.com/livetronic/Arduino-NewPing">https://github.com/livetronic/Arduino-NewPing</a><br>Servo Library <a href="https://github.com/arduino-libraries/Servo.git">https://github.com/arduino-libraries/Servo.git</a> </p></blockquote><p><strong>点击 sketch（项目） &gt;&gt; Include Library（加载库） &gt;&gt; Add .ZIP File（添加zip.文件），把你下载好的库文件添加进去。</strong></p><h2 id="五、成品展示"><a href="#五、成品展示" class="headerlink" title="五、成品展示"></a>五、成品展示</h2><p><img src="http://tva1.sinaimg.cn/mw690/008ruEzYly1gycjki1pbaj33401qohdu.jpg" alt="智能车.jpg"></p>]]></content>
    
    
    <summary type="html">这是一个小巧简单的避障车的设计，也算是Arduino中比较火的项目了，试着学习了一下，通过项目来更深入的理解和应用Arduino</summary>
    
    
    
    <category term="设计开发" scheme="http://yoursite.com/categories/%E8%AE%BE%E8%AE%A1%E5%BC%80%E5%8F%91/"/>
    
    <category term="嵌入式" scheme="http://yoursite.com/categories/%E8%AE%BE%E8%AE%A1%E5%BC%80%E5%8F%91/%E5%B5%8C%E5%85%A5%E5%BC%8F/"/>
    
    
    <category term="嵌入式开发" scheme="http://yoursite.com/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/"/>
    
    <category term="Arduino" scheme="http://yoursite.com/tags/Arduino/"/>
    
  </entry>
  
  <entry>
    <title>【学习记录】关于原博客向新电脑迁移的步骤</title>
    <link href="http://yoursite.com/2022/01/13/Migration_Blog/"/>
    <id>http://yoursite.com/2022/01/13/Migration_Blog/</id>
    <published>2022-01-13T13:37:04.000Z</published>
    <updated>2023-11-01T17:44:42.027Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前提条件"><a href="#前提条件" class="headerlink" title="前提条件"></a>前提条件</h2><p>首先，新电脑肯定是需要安装好<code>nodejs</code>和<code>git</code>的,这是大的前提。</p><h2 id="文件的备份"><a href="#文件的备份" class="headerlink" title="文件的备份"></a>文件的备份</h2><p>文件的备份是个问题，究竟哪些文件是必要的哪些是可以舍弃掉的，一开始我的想法是只要带走博客的md文件就好了，大不了重新发布，然后就意识到这是新做一个网站了，那么把<code>_config.yml</code>文件带走呢？似乎也不够，我们还需要吧<code>themes</code>文件也拷贝过去。那么干脆将整个Blog根目录全部拷贝，但是这样会不会产生冲突？最后参考<a href="https://www.cnblogs.com/iHeling/p/14095937.html">如何迁移hexo博客到新电脑</a>这篇博客，确定了最终的文件。  </p><ul><li>_config.yml</li><li>themes</li><li>source</li><li>scaffolds</li><li>package.json</li><li>gitignore<br>这些文件都有其作用，文章作者如此描述：  <blockquote><p>从之前的博客文件夹中选择必须要拷贝的文件，备份起来。首先是之前自己修改的文件，像配置文件<code>_config.yml</code>,<code>theme</code>文件夹，<code>source</code>文件夹自己写的原始文件这些都是必须要拷贝走的。除此之外还有<code>scaffolds</code>文件夹(文件的模板)，<code>package.json</code>(使用哪些包)，<code>.gitignore</code>(提交忽略哪些文件夹)  </p></blockquote></li></ul><h2 id="正式迁移"><a href="#正式迁移" class="headerlink" title="正式迁移"></a>正式迁移</h2><p>以上准备好之后便开始迁移了，全局安装<code>hexo</code>是很有必要的。  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-cli -g</span><br></pre></td></tr></table></figure><p>然后我们新建一个博客文件夹<br>创建完成之后将我们备份来的文件放进文件夹内，<strong>之后不需要执行<code>hexo init</code>，直接<code>hexo clean&amp;hexo g&amp;hexo s</code>即可。</strong><br>接下来的步骤就与一开始搭建网站时一样了，为了push到github上去，我们需要获取ssh：<br>1.在博客文件夹中打开git bash，然后敲上  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name &quot;yourname&quot;</span><br><span class="line">git config --global user.email &quot;youremail&quot;</span><br></pre></td></tr></table></figure><p>2.创建SSH,密码、路径之类的不用管，一直回车就好</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -C &quot;youremail&quot;</span><br></pre></td></tr></table></figure><p>3.这个时候它会告诉你已经生成了<code>.ssh</code>的文件夹。在你的电脑中找到这个文件夹。<br>ssh，简单来讲，就是一个秘钥，其中，<code>id_rsa</code>是私人秘钥，<code>id_rsa.pub</code>是公共秘钥，可以随便给别人看。把这个公钥放在GitHub上，这样当你链接GitHub自己的账户时，它就会根据公钥匹配你的私钥，当能够相互匹配时，才能够顺利的通过git上传你的文件到GitHub上。<br>而后在GitHub的setting中，<br><img src="https://raw.githubusercontent.com/isNineSun/img_repository/main/%25D%40T6A(JI0U7SE826R9)ZJB.png" alt="1.png"><br>找到SSH and GPC keys的设置选项，<br><img src="https://raw.githubusercontent.com/isNineSun/img_repository/main/1.png" alt="2.png"><br>点击New SSH key<br>把你的id_rsa.pub里面的信息复制进去,title随便填写。  </p><h2 id="结束"><a href="#结束" class="headerlink" title="结束"></a>结束</h2><p>直接发布自己的网站，就完成了个人博客的迁移。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo clean &amp;&amp; hexo g &amp;&amp; hexo d</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">没想到刚开始更新Blog没几天就遇到了需要向新电脑迁移的事情，索性记录下来，由于没怎么接触过前端，个人网站搭建的过程始终让我感到新奇，每天感觉都是在接触新的知识。一开始想要迁移的时候还挺迷茫的，感觉这个过程肯定会有很多坑，没想到最后以外的简单顺利。</summary>
    
    
    
    <category term="学习记录" scheme="http://yoursite.com/categories/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"/>
    
    <category term="随笔/杂项" scheme="http://yoursite.com/categories/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/%E9%9A%8F%E7%AC%94-%E6%9D%82%E9%A1%B9/"/>
    
    
    <category term="学习" scheme="http://yoursite.com/tags/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="记录" scheme="http://yoursite.com/tags/%E8%AE%B0%E5%BD%95/"/>
    
    <category term="Hexo" scheme="http://yoursite.com/tags/Hexo/"/>
    
  </entry>
  
  <entry>
    <title>基于stc89c51Rc的扫码取件设计</title>
    <link href="http://yoursite.com/2022/01/12/ExpressageInfo/"/>
    <id>http://yoursite.com/2022/01/12/ExpressageInfo/</id>
    <published>2022-01-12T09:58:04.000Z</published>
    <updated>2023-11-01T17:35:35.691Z</updated>
    
    <content type="html"><![CDATA[<h2 id="一、项目介绍"><a href="#一、项目介绍" class="headerlink" title="一、项目介绍"></a>一、项目介绍</h2><h3 id="1-课题意义"><a href="#1-课题意义" class="headerlink" title="1.课题意义"></a>1.课题意义</h3><p>当今时代，国内信息化步伐逐渐加快，随着互联网和电子商务的迅速发展和普及，网络购物已成为人们生活中不可缺少的一部分。现在快递服务业已发展到一定规模，但是快递服务效率却停滞不前。一个好的物流公司想要在这个社会站稳脚跟，需要的不仅仅是传输速度，更重要的是用合理的方法来加快精简各个步骤所需要花费的时间和精力，而快递网点系统是物流这个大模块中一个重要的子系统。单纯的人工取货费时费力，本设计以取件码为依据来实现快递的货物识别，取快递时出示取件码，扫码之后，对应的货物自动发声或发光提示其所在位置，据此想法，从而设计本系统。</p><h3 id="2-实现要求"><a href="#2-实现要求" class="headerlink" title="2.实现要求"></a>2.实现要求</h3><p>本课题是设计一个基于单片机的快递网点货物识别系统，以扫码模块、基于单片机的货物识别等关键技术为重点研究对象设计系统，研究设计的目标是在快递网点取货时更加方便，让客户在取货时出示取件码，扫码之后，对应的货物自动发声或者发光提示其所在位置，便于客户快速取件成功。同时需要了解系统原理、原理、特点、控制方式、应用情况、工作流程等，实现系统货物识别、声光控制等基本功能要求。</p><hr><h2 id="二、原件清单"><a href="#二、原件清单" class="headerlink" title="二、原件清单"></a>二、原件清单</h2><ul><li>Stc89c52Rc*1  </li><li>单片机最小系统*1  </li><li>QX1100扫码器*1  </li><li>有源蜂鸣器*3  </li><li>LED发光二极管*3  </li><li>1k电阻*12  </li><li>330Ω电阻*3  </li><li>npn三极管*3  </li><li>杜邦线 若干  </li><li>排针 若干  </li></ul><hr><h2 id="三、原理框图"><a href="#三、原理框图" class="headerlink" title="三、原理框图"></a>三、原理框图</h2><p><img src="http://tva1.sinaimg.cn/large/008ruEzYly1gyarp1xvj5j30820cpt90.jpg" alt="快递信息二维码生成软件流程图" title="软件"><br>软件  </p><p><img src="http://tva1.sinaimg.cn/large/008ruEzYly1gyarp1y4eoj30hq0duaau.jpg" alt="快递信息二维码读取硬件流程图" title="硬件"><br>硬件  </p><h2 id="三、电路连接"><a href="#三、电路连接" class="headerlink" title="三、电路连接"></a>三、电路连接</h2><p><img src="http://tva1.sinaimg.cn/large/008ruEzYly1gyatt2ebp4j30ns0mhtls.jpg" alt="protues仿真连接（仅供参考）"><br>图中1、2、3为三个子端设备，即贴在快递上用来声光报警的设备。仿真图仅供连接参考，我本身是在草稿纸上画的线路因此这个仿真只体现大体思路。  </p><p><strong>注意：实际连接时P2口需接1k的上拉电阻来稳压，发光二极管串联330欧姆电阻，三极管基极接1k电阻。</strong> </p><hr><h2 id="四、实物展示"><a href="#四、实物展示" class="headerlink" title="四、实物展示"></a>四、实物展示</h2><h3 id="1-软件展示"><a href="#1-软件展示" class="headerlink" title="1.软件展示"></a>1.软件展示</h3><p><img src="http://tva1.sinaimg.cn/large/008ruEzYly1gyau3ktfyhj30ag0g30tq.jpg" alt="软件界面">  </p><ul><li>在最上方生成二维码。</li><li>中间填入快递货架号，格式为xxx（<em>排、行、个，如：123，代表第一排第二行第三个</em>）。</li><li>点击录入会自动生成二维码并记录进快递列表。</li><li>点击快递列表即可查看存入快递。</li><li>点击“关闭”关闭应用。</li><li>在qq邮箱栏，输入qq邮箱点击发送会将二维码以邮件附件的形式发送给用户。</li><li>最下方是信息提示栏。  </li></ul><h3 id="2-硬件展示"><a href="#2-硬件展示" class="headerlink" title="2.硬件展示"></a>2.硬件展示</h3><p><img src="http://tva1.sinaimg.cn/mw690/008ruEzYly1gyautmd500j30j60ya0vd.jpg" alt="背面"><br>背面（三个子端）<br><img src="http://tva1.sinaimg.cn/mw690/008ruEzYly1gyauu3cxrhj30tu1hcads.jpg" alt="正面"><br>正面（扫码器）</p><hr><h2 id="五、程序代码"><a href="#五、程序代码" class="headerlink" title="五、程序代码"></a>五、程序代码</h2><h3 id="1-软件程序"><a href="#1-软件程序" class="headerlink" title="1.软件程序"></a>1.软件程序</h3><p>软件是基于unity进行开发的，之所以不选用VS开发是因为对我个人来说unity的ui设计更加直观明了。两者都是用的C#语言，因此在代码方面实际上差别并不很大。以下贴一下关键代码：<br><strong>(1)QQ邮件发送代码</strong>  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">using UnityEngine;</span><br><span class="line">using System.Collections;</span><br><span class="line">using System;</span><br><span class="line">using System.Net;</span><br><span class="line">using System.Net.Mail;</span><br><span class="line">using System.Net.Security;</span><br><span class="line">using System.Security.Cryptography.X509Certificates;</span><br><span class="line">using UnityEngine.UI;</span><br><span class="line">public class Mail : MonoBehaviour</span><br><span class="line">&#123;</span><br><span class="line">    public GameObject Text_02,send;</span><br><span class="line">    public Vector2 creatPosition;</span><br><span class="line"></span><br><span class="line">    public void Update()</span><br><span class="line">    &#123;</span><br><span class="line">        if (GameObject.Find(&quot;QQMileAdress&quot;).GetComponent&lt;Text&gt;().text.Length &lt;= 14)</span><br><span class="line">        &#123;</span><br><span class="line">            send.GetComponent&lt;Button&gt;().interactable = false;</span><br><span class="line">        &#125;</span><br><span class="line">        else</span><br><span class="line">        &#123;</span><br><span class="line">            send.GetComponent&lt;Button&gt;().interactable = true;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void SendEmail()</span><br><span class="line">    &#123;</span><br><span class="line">        MailMessage mail = new MailMessage();</span><br><span class="line"></span><br><span class="line">        mail.From = new MailAddress(&quot;xxx@qq.com&quot;);//发件人</span><br><span class="line">        mail.To.Add(GameObject.Find(&quot;QQMileAdress&quot;).GetComponent&lt;Text&gt;().text);//收件人</span><br><span class="line">        mail.Subject = &quot;Test Mail&quot;;//标题</span><br><span class="line">        mail.Body = &quot;This is for Me&quot;;//内容</span><br><span class="line">        mail.Attachments.Add(new Attachment(Application.dataPath + &quot;/&quot; + &quot;QR.png&quot;));//附件</span><br><span class="line"></span><br><span class="line">        SmtpClient smtpServer = new SmtpClient(&quot;smtp.qq.com&quot;);</span><br><span class="line">        smtpServer.Credentials = new System.Net.NetworkCredential(&quot;xxx@qq.com&quot;, &quot;xxxxxxxxxxxxxx&quot;) as ICredentialsByHost;</span><br><span class="line">        //Credentials证书    NetworkCredential网络证书     xxxxxxxxxxxxxx邮箱授权密码！</span><br><span class="line">        smtpServer.EnableSsl = true;</span><br><span class="line">        ServicePointManager.ServerCertificateValidationCallback =</span><br><span class="line">          delegate (object s, X509Certificate certificate, X509Chain chain, SslPolicyErrors sslPolicyErrors)</span><br><span class="line">          &#123; return true; &#125;;</span><br><span class="line"></span><br><span class="line">        smtpServer.Send(mail);</span><br><span class="line">        Instantiate(Text_02, creatPosition, Quaternion.identity, GameObject.Find(&quot;Canvas&quot;).transform);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p><strong>(2)QR码生成</strong>  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line">using System.Collections;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using UnityEngine;</span><br><span class="line">using UnityEngine.UI;</span><br><span class="line">using ZXing;</span><br><span class="line">using ZXing.QrCode;</span><br><span class="line">using System.IO;</span><br><span class="line"></span><br><span class="line">public class QR_Code : MonoBehaviour</span><br><span class="line">&#123;</span><br><span class="line">    public string QrCodeStr;</span><br><span class="line">    public List&lt;string&gt; Mylist;</span><br><span class="line">    public GameObject Text, createPosition;</span><br><span class="line">    //在屏幕上显示二维码</span><br><span class="line">    public RawImage image;</span><br><span class="line">    public Text Items;</span><br><span class="line">    //存放二维码</span><br><span class="line">    Texture2D encoded;</span><br><span class="line">    int Nmuber = 0;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    void Start()</span><br><span class="line">    &#123;</span><br><span class="line">        encoded = new Texture2D(256, 256);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    void Update()</span><br><span class="line">    &#123;</span><br><span class="line">        if (Input.GetKeyDown(KeyCode.Return))</span><br><span class="line">        &#123;</span><br><span class="line">            Sign();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    /// 定义方法生成二维码</span><br><span class="line">    private static Color32[] Encode(string textForEncoding, int width, int height)</span><br><span class="line">    &#123;</span><br><span class="line">        var writer = new BarcodeWriter</span><br><span class="line">        &#123;</span><br><span class="line">            Format = BarcodeFormat.QR_CODE,</span><br><span class="line">            Options = new QrCodeEncodingOptions</span><br><span class="line">            &#123;</span><br><span class="line">                Height = height,</span><br><span class="line">                Width = width</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        return writer.Write(textForEncoding);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /// 生成二维码</span><br><span class="line">    public void Btn_CreatQr()</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        if (QrCodeStr==null || GameObject.Find(&quot;number&quot;).GetComponent&lt;Text&gt;().text.Length&gt;0)</span><br><span class="line">        &#123;</span><br><span class="line">            QrCodeStr = GameObject.Find(&quot;number&quot;).GetComponent&lt;Text&gt;().text;</span><br><span class="line">            Mylist.Add(QrCodeStr+&quot;\n&quot;);</span><br><span class="line">            //二维码写入图片</span><br><span class="line">            var color32 = Encode(QrCodeStr, encoded.width, encoded.height);</span><br><span class="line">            encoded.SetPixels32(color32);</span><br><span class="line">            encoded.Apply();</span><br><span class="line">            //生成的二维码图片附给RawImage</span><br><span class="line">            image.texture = encoded;</span><br><span class="line">        &#125;</span><br><span class="line">        else </span><br><span class="line">        &#123;</span><br><span class="line">            Instantiate(Text, createPosition.transform.position, Quaternion.identity,transform);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void Sign()</span><br><span class="line">    &#123;</span><br><span class="line">        Btn_CreatQr();</span><br><span class="line">        SaveTextureToFile();</span><br><span class="line">        Nmuber++;</span><br><span class="line">        if (Nmuber &gt;= QrCodeStr.Length)</span><br><span class="line">        &#123;</span><br><span class="line">            Nmuber = 0;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    public void list()</span><br><span class="line">    &#123;</span><br><span class="line">        Items.text = null;</span><br><span class="line">        foreach (var item in Mylist)</span><br><span class="line">        &#123;</span><br><span class="line">            Items.text += item;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    public void Quit()</span><br><span class="line">    &#123;</span><br><span class="line">        Application.Quit();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    void SaveTextureToFile()</span><br><span class="line">    &#123;</span><br><span class="line">        var bytes = encoded.EncodeToPNG();</span><br><span class="line">        File.WriteAllBytes(Application.dataPath + &quot;/&quot; + &quot;QR.png&quot;, bytes);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>(3)52单片机程序</strong>  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;reg52.h&quot;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"></span><br><span class="line">typedef unsigned int u16;//对系统默认数据类型进行重定义</span><br><span class="line">typedef unsigned char u8;</span><br><span class="line">typedef unsigned long u32;</span><br><span class="line"></span><br><span class="line">void delay_10us(u16 ten_us);</span><br><span class="line">void delay_ms(u16 ms);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">unsigned char num[][10]=&#123;&quot;0&quot;,&quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;,&quot;5&quot;,&quot;6&quot;,&quot;7&quot;,&quot;8&quot;,&quot;9&quot;&#125;;</span><br><span class="line">u8 led[9]=&#123;0x00,0x01,0x02,0x04,0x08,0x10,0x20,0x40,0x80&#125;;</span><br><span class="line">u8 n;</span><br><span class="line">//****************************************************************************************</span><br><span class="line"></span><br><span class="line">void delay_10us(u16 ten_us)</span><br><span class="line">&#123;</span><br><span class="line">while(ten_us--);</span><br><span class="line">&#125;</span><br><span class="line">void delay_ms(u16 ms)</span><br><span class="line">&#123;</span><br><span class="line">u16 i,j;</span><br><span class="line">for(i=ms;i&gt;0;i--)</span><br><span class="line">for(j=110;j&gt;0;j--);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//****************************************************************************************</span><br><span class="line">void uart_init(u8 baud)</span><br><span class="line">&#123;</span><br><span class="line">TMOD|=0X20;//设置计数器工作方式2</span><br><span class="line">SCON=0X50;//设置为工作方式1</span><br><span class="line">PCON=0X80;//波特率加倍</span><br><span class="line">TH1=baud;//计数器初始值设置</span><br><span class="line">TL1=baud;</span><br><span class="line">ES=1;//打开接收中断</span><br><span class="line">EA=1;//打开总中断</span><br><span class="line">TR1=1;//打开计数器</span><br><span class="line">&#125;</span><br><span class="line">void main()</span><br><span class="line">&#123;</span><br><span class="line">int r;</span><br><span class="line">uart_init(0XFA);//波特率为9600</span><br><span class="line"></span><br><span class="line">while(1)</span><br><span class="line">&#123;</span><br><span class="line">if(n &gt;= &#x27;0&#x27; &amp;&amp; n &lt;= &#x27;9&#x27;)</span><br><span class="line">r=n-&#x27;0&#x27;;</span><br><span class="line">  P2=led[r];</span><br><span class="line">//lcd1602_init();//LCD1602初始化</span><br><span class="line">  //lcd1602_show_string(0,0,num[r]);//第一行显示</span><br><span class="line">delay_ms(10);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void uart() interrupt 4 //串口通信中断函数</span><br><span class="line">&#123;</span><br><span class="line">u8 rec_data;</span><br><span class="line"></span><br><span class="line">RI = 0;//清除接收中断标志位</span><br><span class="line">rec_data=SBUF;//存储接收到的数据</span><br><span class="line">n=rec_data;</span><br><span class="line">SBUF=rec_data;//将接收到的数据放入到发送寄存器</span><br><span class="line">while(!TI);//等待发送数据完成</span><br><span class="line">TI=0;//清除发送完成标志位</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>有一些用来控制ui动画的小代码就不放出来了，大家根据自己的需要去修改就好。 </p><hr><h2 id="六、设备运行结果"><a href="#六、设备运行结果" class="headerlink" title="六、设备运行结果"></a>六、设备运行结果</h2><p>视频我已上传百度云，需要看设备运行的可以下载来看<br>链接：<a href="https://pan.baidu.com/s/1Evjrf5T2KU6Vl3sgDGIIZQ">百度云</a><br>提取码：k2w6 </p>]]></content>
    
    
    <summary type="html">一种通过取件码快速获得快递位置的设计。</summary>
    
    
    
    <category term="设计开发" scheme="http://yoursite.com/categories/%E8%AE%BE%E8%AE%A1%E5%BC%80%E5%8F%91/"/>
    
    <category term="嵌入式" scheme="http://yoursite.com/categories/%E8%AE%BE%E8%AE%A1%E5%BC%80%E5%8F%91/%E5%B5%8C%E5%85%A5%E5%BC%8F/"/>
    
    
    <category term="嵌入式开发" scheme="http://yoursite.com/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/"/>
    
    <category term="STC51" scheme="http://yoursite.com/tags/STC51/"/>
    
  </entry>
  
  <entry>
    <title>【学习记录】MarkDown语法的学习与整理</title>
    <link href="http://yoursite.com/2022/01/12/MaikdownEdit/"/>
    <id>http://yoursite.com/2022/01/12/MaikdownEdit/</id>
    <published>2022-01-12T06:36:04.000Z</published>
    <updated>2023-11-01T17:56:20.222Z</updated>
    
    <content type="html"><![CDATA[<h2 id="一、Markdown标题"><a href="#一、Markdown标题" class="headerlink" title="一、Markdown标题"></a>一、Markdown标题</h2><p>Markdown的标题可以使用“#”+空格来进行分级，几级标题就写几个“#”，最多可至六级标题。<br>例子：  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 一级标题</span><br><span class="line">## 二级标题</span><br><span class="line">### 三级标题</span><br><span class="line">#### 四级标题</span><br><span class="line">##### 五级标题</span><br><span class="line">###### 六级标题</span><br></pre></td></tr></table></figure><p>效果👇</p><h1 id="一级标题"><a href="#一级标题" class="headerlink" title="一级标题"></a>一级标题</h1><h2 id="二级标题"><a href="#二级标题" class="headerlink" title="二级标题"></a>二级标题</h2><h3 id="三级标题"><a href="#三级标题" class="headerlink" title="三级标题"></a>三级标题</h3><h4 id="四级标题"><a href="#四级标题" class="headerlink" title="四级标题"></a>四级标题</h4><h5 id="五级标题"><a href="#五级标题" class="headerlink" title="五级标题"></a>五级标题</h5><h6 id="六级标题"><a href="#六级标题" class="headerlink" title="六级标题"></a>六级标题</h6><hr><h2 id="二、Markdown段落"><a href="#二、Markdown段落" class="headerlink" title="二、Markdown段落"></a>二、Markdown段落</h2><p>1.使用两个空格来换行<br>例子：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">你好，世界！//无换行</span><br><span class="line">你好，  世界！//换行</span><br></pre></td></tr></table></figure><p>效果👇<br>你好，世界！//无换行</p><p>你好，<br>世界！//换行</p><p>2.使用三个以上“-”来画分割线<br>例子：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">---</span><br></pre></td></tr></table></figure><p>效果👇  </p><hr><p>3.使用“*”来赋予不同的字体<br>例子：  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">*斜体文本*</span><br><span class="line">**粗体文本**</span><br><span class="line">***粗斜体文本***</span><br></pre></td></tr></table></figure><p>效果👇<br><em>斜体文本</em><br><strong>粗体文本</strong><br><em><strong>粗斜体文本</strong></em>  </p><hr><h2 id="三、Markdown代码"><a href="#三、Markdown代码" class="headerlink" title="三、Markdown代码"></a>三、Markdown代码</h2><p>用“```”包裹一段代码，并指定一种语言（也可以不指定）<br>例子：  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">``` </span><br><span class="line">printf();</span><br><span class="line">```</span><br></pre></td></tr></table></figure><p>效果👇  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">printf();</span><br></pre></td></tr></table></figure><hr><h2 id="四、Markdown的链接形式"><a href="#四、Markdown的链接形式" class="headerlink" title="四、Markdown的链接形式"></a>四、Markdown的链接形式</h2><p>用</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[链接名称](www.xxxxxx.com)</span><br></pre></td></tr></table></figure><p>的形式来生成一个不直接暴露网址的链接。<br>例子：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[isNineSun&#x27;s Blog](www.isNineSun.github.io)</span><br></pre></td></tr></table></figure><p>效果👇<br><a href="www.isNineSun.github.io">isNineSun’s Blog</a><br><strong>如果你要直接引用网址而不用包装那么直接打进正文即可</strong></p><hr><h2 id="五、Markdown图片"><a href="#五、Markdown图片" class="headerlink" title="五、Markdown图片"></a>五、Markdown图片</h2><ul><li>开头一个感叹号!</li><li>然后是中括号[]，中间写上你的图片描述，<em>在点开图片的时候会显示</em>。</li><li>后面加上你的图片地址，也可以再多添加一个图片的“描述”。<br>例子：  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">![_嘉然.jpg](http://tva1.sinaimg.cn/large/008ruEzYly1gyawosia27j30hs0hsmy2.jpg)</span><br><span class="line"></span><br><span class="line">![_嘉然.jpg](http://tva1.sinaimg.cn/large/008ruEzYly1gyawosia27j30hs0hsmy2.jpg &quot;嘉然&quot;)</span><br></pre></td></tr></table></figure>效果👇<br><img src="http://tva1.sinaimg.cn/large/008ruEzYly1gyawosia27j30hs0hsmy2.jpg" alt="_嘉然.jpg"></li></ul><p><img src="http://tva1.sinaimg.cn/large/008ruEzYly1gyawosia27j30hs0hsmy2.jpg" alt="_嘉然.jpg" title="嘉然">  </p><hr><h2 id="结束"><a href="#结束" class="headerlink" title="结束"></a>结束</h2><p>这是我日常中可能常用的几个语法的整理，如果你需要更全面的教程，欢迎去访问<a href="https://www.runoob.com/markdown/md-tutorial.html">菜鸟的Markdown教程</a>。</p>]]></content>
    
    
    <summary type="html">接触了一小段时间的Markdown文件的编写了，深感他能被众人所推崇的确有其独特之处，因此开一篇博客记录下markdown常用的一些有语法，既是一种整理也是一个加深印象和巩固的过程。感谢菜鸟教程的详细总结，省去了我不少时间，这里只介绍我常用到的，如果需要请点击链接来更全面的学习https://www.runoob.com/markdown/md-tutorial.html。</summary>
    
    
    
    <category term="学习记录" scheme="http://yoursite.com/categories/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"/>
    
    <category term="语法相关" scheme="http://yoursite.com/categories/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/%E8%AF%AD%E6%B3%95%E7%9B%B8%E5%85%B3/"/>
    
    
    <category term="学习" scheme="http://yoursite.com/tags/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="记录" scheme="http://yoursite.com/tags/%E8%AE%B0%E5%BD%95/"/>
    
    <category term="Markdown" scheme="http://yoursite.com/tags/Markdown/"/>
    
  </entry>
  
  <entry>
    <title>我的第一篇博客</title>
    <link href="http://yoursite.com/2022/01/11/MyFirstBlog/"/>
    <id>http://yoursite.com/2022/01/11/MyFirstBlog/</id>
    <published>2022-01-11T09:58:04.000Z</published>
    <updated>2023-11-01T17:50:22.745Z</updated>
    
    <content type="html"><![CDATA[<h2 id="嗨！"><a href="#嗨！" class="headerlink" title="嗨！"></a>嗨！</h2><p>幸会，这是我的第一篇博客，希望不会是最后一篇233，如果你对我感兴趣，可以看一看我下面的自述。</p><hr><h2 id="这个个人博客的目的"><a href="#这个个人博客的目的" class="headerlink" title="这个个人博客的目的"></a>这个个人博客的目的</h2><p>这个技术博客主要是为了能够更好的记录我在学习中会遇到的种种事情，可能是难题，可能是踩坑，可能是灵感，可能是新的技术，我的涉猎比较广，游戏、单片机、编程、绘画等等我都有兴趣，随着学的东西越来越多，我萌生出将自己所学记录下来的想法，一个个人博客想来是再好不过的方式了，我会尽量在知乎等大的平台上同步更新。<br>我在学习中也不止一次的被他人的技术博客所拯救，一个百思不得其解的问题可能在他人的技术博客中用一两句话就说明白了，颇有“听君一席话胜读十年书”的感觉，我希望我的技术博客也能够帮到每一个人！</p><hr><h2 id="结束"><a href="#结束" class="headerlink" title="结束"></a>结束</h2><p>以上，就结束了我简短的第一篇博客，希望在今后的日子里我能够先将自己的博客充实起来。<br><img src="https://s2.loli.net/2022/01/12/rGQZiH2Fal51BVq.png" alt="This is me" title="This is not me"></p>]]></content>
    
    
    <summary type="html">幸会，这是我的第一篇博客，希望不会是最后一篇233，如果你对我感兴趣，可以看一看我下面的自述。</summary>
    
    
    
    <category term="生活记录" scheme="http://yoursite.com/categories/%E7%94%9F%E6%B4%BB%E8%AE%B0%E5%BD%95/"/>
    
    <category term="碎碎念" scheme="http://yoursite.com/categories/%E7%94%9F%E6%B4%BB%E8%AE%B0%E5%BD%95/%E7%A2%8E%E7%A2%8E%E5%BF%B5/"/>
    
    
    <category term="随笔" scheme="http://yoursite.com/tags/%E9%9A%8F%E7%AC%94/"/>
    
    <category term="HelloWorld" scheme="http://yoursite.com/tags/HelloWorld/"/>
    
  </entry>
  
</feed>
